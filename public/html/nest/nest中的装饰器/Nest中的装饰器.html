<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>Nest中的装饰器 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="Nest中的装饰器 - wolai 笔记回顾前两篇中主要介绍了Nest的入门使用以及一些框架特性，包括模块、控制器、服务注入、Http服务、数据库服务等功能，都涉及到很多的装饰器，这一篇会介绍Nest中的装饰器，以及工作原理。引言装饰器在 Nest 中的角色在 NestJS 中，装饰器是一种强大的工具，对于扩展或修改类、方法、属性或参数的行为，提供了优雅而灵活的方式，使开发人员能够在不修改原始">
<meta property="og:type" content="website">
<meta property="og:title" content="Nest中的装饰器">
<meta property="og:url" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/Nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Nest中的装饰器 - wolai 笔记回顾前两篇中主要介绍了Nest的入门使用以及一些框架特性，包括模块、控制器、服务注入、Http服务、数据库服务等功能，都涉及到很多的装饰器，这一篇会介绍Nest中的装饰器，以及工作原理。引言装饰器在 Nest 中的角色在 NestJS 中，装饰器是一种强大的工具，对于扩展或修改类、方法、属性或参数的行为，提供了优雅而灵活的方式，使开发人员能够在不修改原始">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/media/image.png">
<meta property="og:image" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/media/image_1.png">
<meta property="og:image" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/media/image_2.png">
<meta property="og:image" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/media/image_3.png">
<meta property="og:image" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/media/image_4.png">
<meta property="article:published_time" content="2023-12-11T05:32:20.378Z">
<meta property="article:modified_time" content="2023-12-11T05:32:20.378Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/html/nest/nest%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8/media/image.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/assets/images/banner.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Hexo </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
      <a class="main-nav-link" href="/html/nest">Nest</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
      <a class="nav-dropdown-link" href="/html/nest">Nest</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Huangjiexin </div>
      <div class="dot"></div>
      <div class="subtitle">nothing </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      



    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="page-" class="h-entry article article-type-page" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        Nest中的装饰器
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2023-12-11T05:32:20.378Z" itemprop="datePublished">2023-12-11</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
    Uncategorized 
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            24k words 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          
<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>Nest中的装饰器 - wolai 笔记</title><link rel="shortcut icon"></link></head><body class="full-width"><header><div class="image has" style="background-position-y: 50%; background-image: url(&quot;https://cdn.wostatic.cn/cover/painting/26HnnzT7aex1JAZ7fiAirc.jpg&quot;)"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Nest中的装饰器" class="main-title"></div></div></header><article><h2 id="kfs9RQGPHcqMqeoQUqgSEL" class="wolai-block"><span class="inline-wrap">回顾</span></h2><div id="xp4jdqwNXNrbFPzvc2c8y2" class="wolai-block wolai-text"><div><span class="inline-wrap">前两篇中主要介绍了<span class="jill"></span>Nest<span class="jill"></span>的入门使用以及一些框架特性，包括模块、控制器、服务注入、Http<span class="jill"></span>服务、数据库服务等功能，都涉及到很多的装饰器，这一篇会介绍<span class="jill"></span>Nest<span class="jill"></span>中的装饰器，以及工作原理。</span></div></div><h2 id="8frTphd6WnbW2Gz9kQX8nK" class="wolai-block"><span class="inline-wrap">引言</span></h2><h3 id="aXDSgBmbwUv5HtUajZEgp" class="wolai-block"><span class="inline-wrap">装饰器在 Nest 中的角色</span></h3><ul class="wolai-block"><li id="tp5hUhETK47nNjYNiprmWJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在 NestJS 中，装饰器是一种强大的工具，对于</span><span class="inline-wrap"><b>扩展或修改类、方法、属性或参数</b></span><span class="inline-wrap">的行为，提供了优雅而灵活的方式，使开发人员能够</span><span class="inline-wrap"><b>在不修改原始代码的情况下</b></span><span class="inline-wrap">添加或修改功能。</span></li><li id="nzxs1CoQ8JVQeKapPsJa5g"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">装饰器应用非常广泛，包括</span><span class="inline-wrap"><b>路由、控制器、服务、依赖注入</b></span><span class="inline-wrap">等。它们可以用于定义路由处理程序、中间件、管道，使开发者能够</span><span class="inline-wrap"><b>更专注于业务逻辑的实现</b></span><span class="inline-wrap">，而不必过多关注底层框架细节。</span></li><li id="imwJWsnNv4joWeZJA7kxuw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">NestJS 通过装饰器，提供了</span><span class="inline-wrap"><b>声明式的编程方式</b></span><span class="inline-wrap">，使代码更清晰、易于维护。开发者可以通过在类、方法或属性上应用装饰器来定义元数据或增强其行为，提高代码的</span><span class="inline-wrap"><b>可读性和可维护性</b></span><span class="inline-wrap">。</span></li></ul><h2 id="nzaxxzzXj35YibEtADNUcm" class="wolai-block"><span class="inline-wrap">NestJS 装饰器基础</span></h2><h3 id="u3b5D98NuVTAc13aqDMr4m" class="wolai-block"><span class="inline-wrap">类装饰器</span></h3><ul class="wolai-block"><li id="9jUtK6JSizJmiDy2p2JSSY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">模块相关</span><details id="x7BqRk5i3EQojs1W3JCRRe" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Module()</code></span><span class="inline-wrap">: 声明 Nest 模块。</span></summary><code-block id="3pJH2UXmTmf8RZEpYks6e3" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block></details><details id="t6baGLxJPrsmT42Li8eKV8" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Global()</code></span><span class="inline-wrap">: 声明全局模块。</span></summary><code-block id="hzfaHbGf4sed5zYjtjNNXH" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// helper.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module<span class="token punctuation">,</span> Global <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> HelperService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./helper.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Global</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>HelperService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>HelperService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HelperModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="bPu8gqVFv1RVUgs8Hrk9gp" class="wolai-block wolai-text"><div><span class="inline-wrap">创建了 </span><span class="inline-wrap"><code>HelperModule</code></span><span class="inline-wrap">，并导入了 </span><span class="inline-wrap"><code>HelperService</code></span><span class="inline-wrap">，同时使用 </span><span class="inline-wrap"><code>@Global()</code></span><span class="inline-wrap"> 装饰器标记为全局模块。</span></div></div><code-block id="5aYFVr9uNVb6n82zYkqn3w" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// helper.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HelperService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">generateUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 实际应用中可能会使用更复杂的算法</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="8NPDr4CcQNk1AFhSWLHGhk" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>HelperService</code></span><span class="inline-wrap"> 提供了一个生成唯一标识符的简单功能。</span></div></div><code-block id="f2TqgKZp5WKZBRNkc9JTV4" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> HelperModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./helper/helper.module'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>HelperModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block><div id="8vBxLgvSKYPgNH3EAmRhMM" class="wolai-block wolai-text"><div><span class="inline-wrap">通过将 </span><span class="inline-wrap"><code>HelperModule</code></span><span class="inline-wrap"> 导入到 </span><span class="inline-wrap"><code>AppModule</code></span><span class="inline-wrap"> 中，我们确保整个应用程序都可以访问 </span><span class="inline-wrap"><code>HelperService</code></span><span class="inline-wrap"> 提供的功能。</span></div></div><code-block id="vgscJWEMr22fTbny9Zac8S" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token comment">// import &#123; HelperService &#125; from './helper/helper.service'; 不需要再单独导入</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> appService<span class="token operator">:</span> AppService<span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> helperService<span class="token operator">:</span> HelperService<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> uniqueId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>helperService<span class="token punctuation">.</span><span class="token function">generateUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appService<span class="token punctuation">.</span><span class="token function">getAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>message<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> Unique ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>uniqueId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="pBx7hSfDYJMYhwm5rffDsk" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>HelperService</code></span><span class="inline-wrap"> 被注入到 </span><span class="inline-wrap"><code>AppController</code></span><span class="inline-wrap"> 中，然后使用 </span><span class="inline-wrap"><code>generateUniqueId</code></span><span class="inline-wrap"> 方法生成一个唯一标识符。通过这种方式，你可以在整个应用程序中的任何地方注入 </span><span class="inline-wrap"><code>HelperService</code></span><span class="inline-wrap"> 并使用其中的方法，而不需要在每个模块中都重复导入或提供 </span><span class="inline-wrap"><code>HelperService</code></span><span class="inline-wrap">。这有助于避免代码重复，提高可维护性，并确保全局模块中的功能在整个应用中可用。</span></div></div></details></li><li id="xdaHL9A11uP4YXX2hFtusP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">控制器相关</span><details id="tVhxgsi7BU27oG5siA7Sys" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Controller()</code></span><span class="inline-wrap">: 声明模块里的控制器。</span></summary><code-block id="iHiaayYBefy4nefJAJGV95" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></pre></div></code-block></details></li><li id="tbMyxVLfWHVHDbrPYD3fBW"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">提供者（服务）相关
</span><details id="2HKVHGR1dKU9sUvHNTfM1q" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Injectable()</code></span><span class="inline-wrap">: 声明模块里可以注入的提供者（服务）。</span></summary><code-block id="tKwkqKtfZcie9fRKQB2yVm" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="cTcwJ7SjSZJryznRuAPQPq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Inject</code></span><span class="inline-wrap">：通过 token 手动指定注入的 provider，token 可以是 class 或者 string</span></summary><code-block id="kcYwjFanD9XnXktzV9a92e" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.service.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable<span class="token punctuation">,</span> Inject <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> LoggerService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./logger.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span>LoggerService<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> logger<span class="token operator">:</span> LoggerService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token function">getAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Getting app message...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'Hello from AppService!'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="4xts2F2s5p1FRGYnkrt9Lm" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Optional()</code></span><span class="inline-wrap">: 声明注入的依赖服务是可选的，可以为空。(注入的依赖如果没有的话，创建对象时会报错)</span></summary><code-block id="9M3qvatK2JCkJ9vQfJnMDP" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// optional.service.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable<span class="token punctuation">,</span> Optional <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">OptionalService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Optional Service Data'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// app.service.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable<span class="token punctuation">,</span> Optional <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> OptionalService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./optional.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Optional</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">private</span> optionalService<span class="token operator">:</span> OptionalService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> optionalData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>optionalService <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>optionalService<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">'Optional service is not available'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello World! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>optionalData<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details></li></ul><div id="g5SsJdwmgrQV34x4wArCoQ" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="nmG2tHRpx4WG9TVNL2ydHf" class="wolai-block"><span class="inline-wrap">方法装饰器</span></h3><ul class="wolai-block"><li id="N87vrx7k8PAGFbW9QLAaq"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">HTTP 相装饰器</span><details id="pfg8wncCWvghPknMY9Wu4w" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b><code>@Get()</code></b></span><span class="inline-wrap"><b>、</b></span><span class="inline-wrap"><b><code>@Post()</code></b></span><span class="inline-wrap"><b>、</b></span><span class="inline-wrap"><b><code>@Put()</code></b></span><span class="inline-wrap"><b>、</b></span><span class="inline-wrap"><b><code>@Patch()</code></b></span><span class="inline-wrap"><b>、</b></span><span class="inline-wrap"><b><code>@Delete()</code></b></span><span class="inline-wrap"><b> 、@Options()、@Head()等装饰器：</b></span></summary><code-block id="8jyFVj6JxwVtNMZcR2tEdH" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Put<span class="token punctuation">,</span> Patch<span class="token punctuation">,</span> Delete <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'GET request handled'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">postData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'POST request handled'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Put</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">putData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'PUT request handled'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Patch</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">patchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'PATCH request handled'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Delete</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">deleteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'DELETE request handled'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="eyot87xodUjPeJvBTXX4yr" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@HttpCode()</code></span><span class="inline-wrap">: 修改响应的状态码。</span></summary><code-block id="wEDRbMLTcaTEhmjocNTZVH" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> HttpCode <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">HttpCode</span></span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span> <span class="token comment">// 将 HTTP 状态码设置为 201 Created</span>
  <span class="token function">getExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'带有自定义状态码的示例响应'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="7nahEPYLNEJCKaMovKdRtn" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Header()</code></span><span class="inline-wrap">: 修改响应头。</span></summary><code-block id="t7RPy39xrj6JA2QHHwwgnL" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Header <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Header</span></span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'no-store'</span><span class="token punctuation">)</span> <span class="token comment">// 将 Cache-Control 头设置为 'no-store'</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Header</span></span><span class="token punctuation">(</span><span class="token string">'Custom-Header'</span><span class="token punctuation">,</span> <span class="token string">'Custom-Value'</span><span class="token punctuation">)</span> <span class="token comment">// 添加自定义头部</span>
  <span class="token function">getExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'带有自定义头部的示例响应'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="cvwrLoxSqUG878njdZuQdE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Redirect()</code></span><span class="inline-wrap">: 指定重定向的 URL。</span></summary><code-block id="ai6XhJzXECxW4yWpvZ5zUM" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Redirect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'redirect'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Redirect</span></span><span class="token punctuation">(</span><span class="token string">'https://www.example.com'</span><span class="token punctuation">)</span> <span class="token comment">// 重定向到指定的 URL</span>
  <span class="token function">getRedirectExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 由于重定向，此方法将不会被执行</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="4w27YzafxMprPDzrotypXz" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Render()</code></span><span class="inline-wrap">: 指定渲染用的模板引擎。</span></summary><code-block id="tr2XaTmi2G2GZZgJrPUWsr" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Render <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'render'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Render</span></span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token comment">// 使用默认视图引擎渲染 'index' 模板</span>
  <span class="token function">getRenderExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> message<span class="token operator">:</span> <span class="token string">'你好，NestJS！'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 传递给视图的数据</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details></li></ul><h3 id="vKAFFYKnWjSxexv2LJy9hB" class="wolai-block"><span class="inline-wrap">参数装饰器</span></h3><ul class="wolai-block"><li id="wEKfqXLfkt18LgQUNcLtxk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>请求对象和响应对象相关</b></span><details id="tWyWdm6S3NwCnoC1MfbJ5v" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Req()</code></span><span class="inline-wrap">, </span><span class="inline-wrap"><code>@Request()</code></span><span class="inline-wrap">: 注入 request 对象。</span></summary><div id="gkhd2LPyoQt6MQGFy2B8oJ" class="wolai-block wolai-text"><div></div></div><code-block id="2uQkyxKQEPhqD2E2LR74JY" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Req<span class="token punctuation">,</span> Request <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Request <span class="token keyword">as</span> ExpressRequest <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> request<span class="token operator">:</span> ExpressRequest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request URL: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/alternative'</span><span class="token punctuation">)</span>
  <span class="token function">getDataAlternative</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Request</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> request<span class="token operator">:</span> ExpressRequest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request URL (Alternative): </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="eNaMZsRKy1fMZQRhx6WUo" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Res()</code></span><span class="inline-wrap">, </span><span class="inline-wrap"><code>@Response()</code></span><span class="inline-wrap">: 注入 response 对象，</span></summary><code-block id="gTZRRrtN9cm6cQGM9k9UE9" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Res<span class="token punctuation">,</span> Response <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Response <span class="token keyword">as</span> ExpressResponse <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> response<span class="token operator">:</span> ExpressResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello, World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'/alternative'</span><span class="token punctuation">)</span>
  <span class="token function">sendDataAlternative</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Response</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> response<span class="token operator">:</span> ExpressResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello, World! (Alternative)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details></li><li id="6UuCpiMW1u7Kt484TDVyMh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>路由参数相关</b></span><details id="tMvXBC8YDsJJHfiap1Hv95" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Param()</code></span><span class="inline-wrap">: 取出 URL 中的参数。</span></summary><div id="vQHXmq8EEHfpcQurSwkLkE" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Param(&#39;id&#39;)</code></span><span class="inline-wrap"> 用于提取 URL 中的参数，并将其作为方法参数传递给 </span><span class="inline-wrap"><code>getData</code></span><span class="inline-wrap"> 方法。</span></div></div><code-block id="jF5zCWQeaDJAEGRsybxiQt" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Param <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Data for ID </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="7RuFiw3vY5SMPV49jp5mok" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Query()</code></span><span class="inline-wrap">: 取出 query 部分的参数。</span></summary><div id="bfb7GWupyuEKBUQPT91bVZ" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Query(&#39;param&#39;)</code></span><span class="inline-wrap"> 用于提取 URL 查询参数，并将其作为方法参数传递给 </span><span class="inline-wrap"><code>getData</code></span><span class="inline-wrap"> 方法。</span></div></div><code-block id="qJ9FX8EAUmYEuQKAE7k8BB" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Query <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token string">'param'</span><span class="token punctuation">)</span> param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Received query parameter: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="cTy1m8JwNpKeFxxNYVKhRy" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Body()</code></span><span class="inline-wrap">: 取出请求 body，通过 DTO class 来接收。</span></summary><div id="k65opH8jGw47RoQQ2ccx7G" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Body()</code></span><span class="inline-wrap"> 用于提取请求体中的数据，并将其作为方法参数传递给 </span><span class="inline-wrap"><code>createItem</code></span><span class="inline-wrap"> 方法。</span></div></div><code-block id="3P7iHCeN69oEgMxB2U3Vor" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Body <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CreateItemDto</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">createItem</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> createItemDto<span class="token operator">:</span> CreateItemDto<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Logic to create an item using the provided data</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Created item: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>createItemDto<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="8r7YqqAocmKMSq7SGeM6K5" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Headers()</code></span><span class="inline-wrap">: 取出某个或全部请求头。</span></summary><div id="obvCgB8RZU7pUBRkCcuf4K" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Headers(&#39;authorization&#39;)</code></span><span class="inline-wrap"> 用于提取请求头中的 </span><span class="inline-wrap"><code>authorization</code></span><span class="inline-wrap"> 数据，并将其作为方法参数传递给 </span><span class="inline-wrap"><code>getData</code></span><span class="inline-wrap"> 方法</span></div></div><code-block id="fhLbETPErZuX1wk4fJh8T6" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Headers <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Headers</span></span><span class="token punctuation">(</span><span class="token string">'authorization'</span><span class="token punctuation">)</span> authorization<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Authorization header: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>authorization<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="aYQyAykCpTshrvj89A8zrd" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@Session()</code></span><span class="inline-wrap">: 取出 session 对象，需要启用 express-session 中间件。</span></summary><div id="8qFhqgC31xbiujXHF1SULw" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Session()</code></span><span class="inline-wrap"> 装饰器允许你访问存储在用户会话中的数据。</span></div></div><blockquote id="uwtcpyXxjwX363mQHPycQL" class="wolai-block"><span class="inline-wrap">确保在使用 </span><span class="inline-wrap"><code>@Session()</code></span><span class="inline-wrap"> 装饰器之前，你已经正确配置并启用了 </span><span class="inline-wrap"><code>express-session</code></span><span class="inline-wrap"> 中间件。</span></blockquote><code-block id="asqXAUZkKX77h6UaR8Z3JR" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Session <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Session</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> session<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Access session data</span>
    <span class="token keyword">const</span> userId <span class="token operator">=</span> session<span class="token punctuation">.</span>userId<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User ID from session: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="mDN9EKQroCPwZip9vZsFoo" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@HostParam()</code></span><span class="inline-wrap">: 取出 host 里的参数。</span></summary><code-block id="bCBAacxHkwMRZ89jnSdbPK" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> HostParam <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example/:subdomain'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getSubdomain</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">HostParam</span></span><span class="token punctuation">(</span><span class="token string">'subdomain'</span><span class="token punctuation">)</span> subdomain<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Subdomain: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>subdomain<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details></li></ul><h3 id="wSRR5JymoLx3Wg3TWCfBWe" class="wolai-block"><span class="inline-wrap">功能性装饰器</span><details id="7uTreWNVCFsWfBfr7umdur" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b><code>@UseGuards()</code></b></span><span class="inline-wrap"><b> 添加身份验证、授权等守卫</b></span></summary><code-block id="uhdwr6vpKSRmjRLy5WTt4S" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UseGuards <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AuthGuard <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./auth.guard'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'secured'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SecuredController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UseGuards</span></span><span class="token punctuation">(</span>AuthGuard<span class="token punctuation">)</span>
  <span class="token function">getSecuredData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Secured data'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="a8QefobhvSK6RoSjBniHen" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b><code>@UseInterceptors()</code></b></span><span class="inline-wrap"><b> 使用拦截器</b></span></summary><code-block id="c6ViiTe6XbtwHyH573yfsK" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UseInterceptors <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> LoggingInterceptor <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./logging.interceptor'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span>LoggingInterceptor<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'GET request handled'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="qZRyV94GqWLof8bSsm7BNP" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b><code>@UseFilters()</code></b></span><span class="inline-wrap"><b> 使用异常过滤器</b></span></summary><code-block id="p7oRrAJm2vEyqEHCPydYae" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UseFilters <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CustomExceptionFilter <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./custom-exception.filter'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span>CustomExceptionFilter<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unexpected error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="uB2nBjHNtjiBLWtHdmbpx9" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b><code>@UsePipes()</code></b></span><span class="inline-wrap"><b> 使用管道</b></span></summary><code-block id="p4RWLEL9qg5aSdQ5E6rDX1" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UsePipes<span class="token punctuation">,</span> ValidationPipe <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UsePipes</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Some logic here</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="6wZtAcanfxGsRkm9f5XWKr" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b><code>@Next()</code></b></span><span class="inline-wrap">: 注入调用下一个 handler 的 next 方法。</span></summary><div id="2yKDRUHTEzvRjbHj28eYTM" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Next()</code></span><span class="inline-wrap"> 装饰器注入 </span><span class="inline-wrap"><code>next</code></span><span class="inline-wrap"> 函数，该函数用于将控制传递给下一个中间件或处理程序函数。</span></div></div><code-block id="vNjDCQ4gnGHsPFUyWxhakQ" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MyMiddleware</span> <span class="token punctuation">&#123;</span>
  <span class="token function">use</span><span class="token punctuation">(</span>req<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> res<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Before handling the request...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用 @Next() 装饰器注入的 next 函数，将控制传递给下一个中间件或处理程序</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'After handling the request...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="9Aqaan9JVYwTTM9vbf9g3B" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>@SetMetadata()</code></span><span class="inline-wrap">: 在 class 或者 handler 上添加 metadata。</span></summary><div id="gd1FyLH6yqjzxBv6YxqCkq" class="wolai-block wolai-text"><div><span class="inline-wrap">这个装饰器的底层实现就是 Reflect.defineMetadata；</span></div></div><div id="2WrsMP1Uvsyo3wKedwM5pD" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image.png" style="width: 590px"/></figure></div><div id="4ebVEBrHDPutxZphXeeZ6J" class="wolai-block wolai-text"><div><span class="inline-wrap">怎么使用的，举个例子：</span></div></div><div id="vN2KjbvVSCpFZ3jpFumSAH" class="wolai-block wolai-text"><div><span class="inline-wrap">我们可以使用 </span><span class="inline-wrap"><code>@SetMetadata()</code></span><span class="inline-wrap"> 装饰器结合自定义装饰器和拦截器来实现一个基本的权限控制系统。</span></div></div><div id="d8BtTFLQ9Vh8xuAWqPVwV1" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，定义一个自定义装饰器 </span><span class="inline-wrap"><code>@Roles()</code></span><span class="inline-wrap"> 用于在处理程序上设置角色权限：</span></div></div><code-block id="rpmpoLxbcfCHsTehXgkWD6" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// roles.decorator.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> SetMetadata <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Roles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>roles<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">SetMetadata</span><span class="token punctuation">(</span><span class="token string">'roles'</span><span class="token punctuation">,</span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="6LBqrfjbcRwh9C3gjvAJv5" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来，创建一个守卫 </span><span class="inline-wrap"><code>RolesGuard</code></span><span class="inline-wrap">检查用户的角色是否符合处理程序所需的角色：</span></div></div><code-block id="chwqPWiiTQcyj7Jb51SNQx" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// roles.guard.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CanActivate<span class="token punctuation">,</span> ExecutionContext<span class="token punctuation">,</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Reflector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RolesGuard</span> <span class="token keyword">implements</span> <span class="token class-name">CanActivate</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> reflector<span class="token operator">:</span> Reflector<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token function">canActivate</span><span class="token punctuation">(</span>context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> requiredRoles <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reflector<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'roles'</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requiredRoles<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 如果没有设置角色要求，则允许访问</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> requiredRoles<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>role <span class="token operator">=></span> user<span class="token punctuation">.</span>roles<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="qABPKcHJvf6qTk25UbgENB" class="wolai-block wolai-text"><div><span class="inline-wrap">最后，将这个守卫应用于一个需要权限控制的控制器：</span></div></div><code-block id="n8q1YhL8Mgs48Zv5mYTD88" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UseGuards <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> RolesGuard <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./roles.guard'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Roles <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./roles.decorator'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Roles</span></span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token comment">// 使用 @Roles 装饰器设置角色要求</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UseGuards</span></span><span class="token punctuation">(</span>RolesGuard<span class="token punctuation">)</span> <span class="token comment">// 使用守卫进行权限检查</span>
  <span class="token function">getAdminData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Admin Data'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Roles</span></span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token comment">// 使用 @Roles 装饰器设置角色要求</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UseGuards</span></span><span class="token punctuation">(</span>RolesGuard<span class="token punctuation">)</span> <span class="token comment">// 使用守卫进行权限检查</span>
  <span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'User Data'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="4DwtqsbgsmwgPvBBqx92FR" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个例子中，</span><span class="inline-wrap"><code>@Roles()</code></span><span class="inline-wrap"> 装饰器用于设置每个处理程序需要的角色权限，然后 </span><span class="inline-wrap"><code>RolesGuard</code></span><span class="inline-wrap"> 拦截器会检查用户是否具备足够的权限。这里使用了 </span><span class="inline-wrap"><code>@UseGuards()</code></span><span class="inline-wrap"> 装饰器来将 </span><span class="inline-wrap"><code>RolesGuard</code></span><span class="inline-wrap"> 拦截器应用于相应的处理程序。</span></div></div><div id="gBCQEM8LPsdsGVBtGM1wX4" class="wolai-block wolai-text"><div><span class="inline-wrap">通过使用元数据，我们能够动态地设置和获取处理程序的角色权限要求，实现了一个基本的权限控制系统。这种方式提供了更灵活和可扩展的权限管理机制。</span></div></div></details></h3><div id="uyBkSNxsyYz6KXFwMWwB8F" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 id="7BRaTChsjKDXVa18RELJow" class="wolai-block"><span class="inline-wrap">深入了解装饰器</span></h2><h3 id="hB8yAogDiSVFc1Ne44BhiX" class="wolai-block"><span class="inline-wrap">装饰器的工作原理</span></h3><ul class="wolai-block"><li id="Ln2DZDosCfHcyy7uqkS3b"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Reflect 对象</span><div id="fN7zMFevtrJTa2xdD2qc1j" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>Reflect</code></span><span class="inline-wrap"> 是 JavaScript 的内置对象，提供了一组静态方法，用于拦截和修改 JavaScript 操作。</span></div></div><details id="kNLyKTihtdeqPKA2aE3Xc3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b>常见 Reflect 方法：</b></span><span class="inline-wrap"> 包括 </span><span class="inline-wrap"><code>Reflect.get</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>Reflect.set</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>Reflect.has</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>Reflect.apply</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>Reflect.construct</code></span><span class="inline-wrap"> 等，用于属性获取、设置、判断存在、方法调用和实例构造等操作。</span></summary><code-block id="t8JBWVoAGtgnvaps1c7SJv" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> value <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> hasProperty <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">Reflect</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>max<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
<span class="token keyword">let</span> instance <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>Date<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前时间的 Date 实例</span>
</pre></div></code-block></details><details id="p89hNw5TpgrcnctwosoRm3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><b>Metadata API</b></span></summary><div id="mVJFwvowxUuqFMNN93HNzK" class="wolai-block wolai-text"><div><span class="inline-wrap">但实现 Nest 用到的 api 还没有进入标准，还在草案阶段；</span></div></div><code-block id="aRnhtvdcFDXVWSwvo14E6F" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre>Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span>metadataKey<span class="token punctuation">,</span> metadataValue<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span>metadataKey<span class="token punctuation">,</span> metadataValue<span class="token punctuation">,</span> target<span class="token punctuation">,</span> propertyKey<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">let</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span>metadataKey<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span>metadataKey<span class="token punctuation">,</span> target<span class="token punctuation">,</span> propertyKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="41qcbKhmNbvpoVeY5tk88C" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Reflect.defineMetadata</b></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><b>Reflect.getMetadata</b></span><span class="inline-wrap"> 分别用于设置和获取某个类的元数据，如果最后传入了属性名，还可以单独为某个属性设置元数据。</span></div></div></details></li></ul><details id="asqT6YtgYjqJY8bJvKHxZy" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">元数据的存储和读取</span></summary><div id="gxacnjJqhRoVxR4A5gaA2L" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>元数据存在哪呢？</b></span></div></div><div id="3bgvG5FtX64YiVh1Abqyvq" class="wolai-block wolai-text"><div><span class="inline-wrap">存在类或者对象上，如果</span><span class="inline-wrap"><b>给类或者类的静态属性添加元数据</b></span><span class="inline-wrap">，那就保存在类上；</span></div></div><div id="6D2uq8cnyg366JCXiwteVN" class="wolai-block wolai-text"><div><span class="inline-wrap">如果</span><span class="inline-wrap"><b>给实例属性添加元数据</b></span><span class="inline-wrap">，那就保存在实例对象上，用类似</span><span class="inline-wrap"><b> [[metadata]]</b></span><span class="inline-wrap"> 的 key 来存的。</span></div></div><div id="25CBjrwkkFEiq7d8EA72D" class="wolai-block wolai-text"><div><span class="inline-wrap">看上面的 api 确实看不出啥，但它</span><span class="inline-wrap"><b>支持装饰器的方式</b></span><span class="inline-wrap">使用：</span></div></div><div id="qiFrx9GVHT8RWQQNoLutUg" class="wolai-block wolai-text"><div><span class="inline-wrap">1.</span><span class="inline-wrap"><b>Reflect.metadata 装饰器</b></span></div></div><code-block id="xmTooevCqECpzoYsYXP9Nu" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token decorator"><span class="token at operator">@</span><span class="token function">Reflect</span></span><span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span>metadataKey<span class="token punctuation">,</span> metadataValue<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Reflect</span></span><span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span>metadataKey<span class="token punctuation">,</span> metadataValue<span class="token punctuation">)</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="7RyfKZuH8FZSctvxbncDVP" class="wolai-block wolai-text"><div><span class="inline-wrap">2.</span><span class="inline-wrap"><b>装饰器的封装：</b></span><span class="inline-wrap"> 将 Reflect.metadata 装饰器封装为更具表达力的装饰器，例如 </span><span class="inline-wrap"><code>Type</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>ParamTypes</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>ReturnType</code></span><span class="inline-wrap">。</span></div></div><code-block id="ozvCv2VgtMTaL4PvzHinUb" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">function</span> <span class="token function">Type</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token string">"design:type"</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">ParamTypes</span><span class="token punctuation">(</span><span class="token operator">...</span>types<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token string">"design:paramtypes"</span><span class="token punctuation">,</span> types<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">ReturnType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token string">"design:returntype"</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">ParamTypes</span></span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ReturnType</span></span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">"text"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Type</span></span><span class="token punctuation">(</span><span class="token builtin">Function</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ParamTypes</span></span><span class="token punctuation">(</span>Number<span class="token punctuation">,</span> Number<span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ReturnType</span></span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span>
  <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="2eZt6Sk8NYYC7s5c1oSvng" class="wolai-block wolai-text"><div><span class="inline-wrap">然后我们就可以通过 Reflect metadata 的 api 获取这个类和对象的元数据了：</span></div></div><code-block id="qKztrD8KzoJygRpPxNba4K" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> paramTypes <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token string">"design:paramtypes"</span><span class="token punctuation">,</span> obj<span class="token punctuation">,</span> <span class="token string">"add"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [Number, Number]</span>
</pre></div></code-block></details><div id="eEN2EQetKhLMGixoJ137tE" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="uesFiCyVAWbvbu2X7RVyeg" class="wolai-block"><span class="inline-wrap">NestJS<span class="jill"></span>中是如何实现的</span></h3><div id="mY1TaCAAVkkkHuxFm1LXL9" class="wolai-block wolai-text"><div><span class="inline-wrap"> 先看一段源码：</span></div></div><div id="5EveQg6h4QDA7tNZUbQ4Y9" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image_1.png" style="width: 830px"/></figure></div><div id="cvAdccgjckJKZRu3pkTVK5" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Module</code></span><span class="inline-wrap"> 装饰器调用了 </span><span class="inline-wrap"><code>Reflect.defineMetadata</code></span><span class="inline-wrap"> 来给这个类添加了一些元数据。所以我们这样用的时候：</span></div></div><code-block id="wioS5AJQkgxBsRWADyZPS7" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="pB1kgRNr1M6WMEsEtgx4ir" class="wolai-block wolai-text"><div><span class="inline-wrap"> 其实就是给 AppModule 添加了 controllers 的元数据和 providers 的元数据。后面创建 IOC 容器的时候就会取出这些元数据来处理。</span></div></div><blockquote id="nXoyaPv4BTjE8aPRucs8eF" class="wolai-block"><span class="gray inline-wrap">现在 metadata 的 api 还在草案阶段，需要使用 reflect-metadata 这个 polyfill 包才行。</span></blockquote><div id="opxWxCsmyGkevULNRfSbwp" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="hujrHXA584zNBkxwpTV4rk" class="wolai-block"><span class="inline-wrap">为什么用<span class="jill"></span>Typescript</span></h3><details id="ogosepz5JjMStr7TXxW9iA" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">完整例子</span></summary><code-block id="fobzw3TWNDWcgfFNCX9Hqs" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// logger.service.ts </span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LoggerService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//  example.service.ts </span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> LoggerService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./logger.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> loggerService<span class="token operator">:</span> LoggerService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token function">performTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loggerService<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Task performed!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//  example.controller.ts </span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ExampleService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./example.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleController</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> exampleService<span class="token operator">:</span> ExampleService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>exampleService<span class="token punctuation">.</span><span class="token function">performTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'Data from Nest.js!'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//  app.module.ts </span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ExampleController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./example.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ExampleService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./example.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> LoggerService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./logger.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>ExampleController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>ExampleService<span class="token punctuation">,</span> LoggerService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block><div id="rLJz8d8ssgjMqJBWuVEmkb" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details><details id="wrjtpN2z4oDiBfzd6hd1cK" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">执行顺序</span></summary><div id="s8FvJjaV8tADViKon8veYi" class="wolai-block wolai-text"><div><span class="inline-wrap">在 Nest.js 中，整个依赖扫描和实例化的过程可以按照以下时间线来描述，同时结合三个元数据 (</span><span class="inline-wrap"><code>design:type</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>design:returntype</code></span><span class="inline-wrap">) 的作用：</span></div></div><ol class="wolai-block"><li id="px3zbJjBBgm5M2yCwhn8Lb"><div class="marker"></div><span class="inline-wrap"><b>模块装载（Module Loading）：</b></span><ul class="wolai-block"><li id="qyGEh6JPdmNp1YaFyp4VLQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nest.js 应用程序启动时，首先会装载主模块（通常是 </span><span class="inline-wrap"><code>AppModule</code></span><span class="inline-wrap">）。</span></li><li id="9Wr9bXHUw2yDmQkfEV9KCN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在主模块中，使用 </span><span class="inline-wrap"><code>@Module</code></span><span class="inline-wrap"> 装饰器指定模块的元数据，包括控制器和提供者。</span></li></ul></li><li id="dFmcuU1PnAAgXgGdAsjzQ"><div class="marker"></div><span class="inline-wrap"><b>提供者扫描（Provider Scanning）：</b></span><ul class="wolai-block"><li id="8awZppggKPNDaq7mmP24j"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nest.js 模块扫描提供者（</span><span class="inline-wrap"><code>@Injectable()</code></span><span class="inline-wrap"> 装饰的类），解析其元数据。</span></li><li id="phKmLJYchRXyKr6dYyLWmL"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>design:type</code></span><span class="inline-wrap"> 元数据描述提供者的类型。例如，如果有一个提供者类 </span><span class="inline-wrap"><code>LoggerService</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>design:type</code></span><span class="inline-wrap"> 可能是 </span><span class="inline-wrap"><code>Function</code></span><span class="inline-wrap"> 表示它是一个类构造函数。</span></li></ul></li><li id="9cnKuTdWTTgSbK1K11gR9s"><div class="marker"></div><span class="inline-wrap"><b>构造函数参数扫描（Constructor Parameter Scanning）：</b></span><ul class="wolai-block"><li id="vMZUHS5WB4CdWVoBsYJuZP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于每个提供者，检查其构造函数，并使用 </span><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 元数据获取构造函数参数的类型信息。</span></li><li id="8BqdVM9D2Z74CJ9HXizRCD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 是一个数组，描述了构造函数的参数类型。例如，</span><span class="inline-wrap"><code>ExampleService</code></span><span class="inline-wrap"> 的构造函数参数是 </span><span class="inline-wrap"><code>LoggerService</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 可能是 </span><span class="inline-wrap"><code>[LoggerService]</code></span><span class="inline-wrap">。</span></li></ul></li><li id="8FuuvMU4UYGq4DoYTTTGqv"><div class="marker"></div><span class="inline-wrap"><b>模块初始化和实例化（Module Initialization and Instantiation）：</b></span><ul class="wolai-block"><li id="vSYt5F1sAQvchdS1ko3Qcu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于每个提供者，IoC 容器根据构造函数参数递归实例化其依赖项。</span></li><li id="eGBoDgmoBk5GXNFYTrzjiL"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用提供者的构造函数创建实例，并将依赖项注入到构造函数中。</span></li><li id="jZkn3NQiWSba7LUkP3WHCm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果有其他模块被导入，重复上述步骤。</span></li></ul></li><li id="7nywMgjxX6m4oGYmiy2gcY"><div class="marker"></div><span class="inline-wrap"><b>控制器扫描和路由解析（Controller Scanning and Route Resolution）：</b></span><ul class="wolai-block"><li id="n2K6Dti2kpGXbpdGY57c4s"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nest.js 模块扫描控制器（</span><span class="inline-wrap"><code>@Controller()</code></span><span class="inline-wrap"> 装饰的类）。</span></li><li id="cyPMKByJSxd75J57UniQmr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于每个控制器类，解析其元数据，包括路由和路由处理方法。</span></li></ul></li><li id="7LrdqCDzLwAreZsiuHhGrJ"><div class="marker"></div><span class="inline-wrap"><b>方法元数据解析（Method Metadata Resolution）：</b></span><ul class="wolai-block"><li id="hqMWeMDgyiAfp6Q72c45uw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于每个路由处理方法，解析其元数据，包括 </span><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>design:returntype</code></span><span class="inline-wrap">。</span></li><li id="fSTSGVZusYNAT9tKHRRHq1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 描述了方法的参数类型，而 </span><span class="inline-wrap"><code>design:returntype</code></span><span class="inline-wrap"> 描述了方法的返回值类型。</span></li></ul></li></ol><div id="cBdwFhJtiomRb9KKyYfoeK" class="wolai-block wolai-text"><div><span class="inline-wrap">总体而言，Nest.js 的 IoC 容器在模块装载和初始化过程中，通过装饰器中的元数据来实现提供者和控制器的扫描、实例化和依赖注入。三个元数据在这个过程中提供了关键的类型信息，确保了正确的依赖解析和注入。这使得 Nest.js 能够在运行时动态地管理类之间的依赖关系，实现依赖注入和路由解析等功能。</span></div></div></details><div id="evx4YBx8GMbJbbJormXMz9" class="wolai-block wolai-text"><div><span class="inline-wrap">细心的同学可能会发现，上面的例子一般是扫描加载指定模块的元数据，包括<span class="jill"></span>controller<span class="jill"></span>和<span class="jill"></span>provider，但是在创建示例时，是需要知道构造器的参数，现在并没有添加这部分 metadata 数据呀，所以这里需要提到<span class="jill"></span>Typescript<span class="jill"></span>的优势，TypeScript 支持编译时自动添加一些 metadata 数据：</span></div></div><div id="ppsLMx168a48ggVLaU4gmT" class="wolai-block wolai-text"><div><span class="inline-wrap">比如这段代码：</span></div></div><div id="b6mW4Hm9zg3tg9xnEdsubX" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image_2.png" style="width: 554px"/></figure></div><div id="us4abxZSQijAwVpVeC6xK8" class="wolai-block wolai-text"><div><span class="inline-wrap">添加了一个元数据，生成后的代码是这样的：</span></div></div><div id="gqJr1njpx4AjhJzM5xHocr" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image_3.png" style="width: 601px"/></figure></div><div id="babMaqtoFiSZa6XShzYruZ" class="wolai-block wolai-text"><div><span class="inline-wrap">但是呢，ts 有一个编译选项叫做 </span><span class="inline-wrap"><code>emitDecoratorMetadata</code></span><span class="inline-wrap">，开启它就会自动添加一些元数据。开启之后再试一下：</span></div></div><div id="qRDRmbXBBLMpENamJpg4Pr" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="media/image_4.png" style="width: 608px"/></figure></div><div id="eVYUtEVdcZZoH1247nHawT" class="wolai-block wolai-text"><div><span class="inline-wrap">会看到多了三个元数据：</span></div></div><div id="9Qr4U2HJSycHWBdHDZSKGz" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>design:type</code></span><span class="inline-wrap">是<span class="jill"></span>Function，是描述装饰目标的元数据，这里装饰的是函数</span></div></div><div id="uXXpx6XHFVoBUK7piTvWu" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 是 [Number]，是参数的类型</span></div></div><div id="qySUZZy71wmQpwReLY31Dz" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>design:returntype</code></span><span class="inline-wrap"> 是 String，是返回值的类型</span></div></div><div id="s6stezuQjqkc4jNF41cDMU" class="wolai-block wolai-text"><div><span class="inline-wrap">所以，只要开启了这个编译选项，ts 生成的代码会自动添加一些元数据。然后创建对象的时候就可以通过 </span><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap"> 来拿到构造器参数的类型了，也就知道怎么注入依赖，怎么去<span class="jill"></span>new<span class="jill"></span>实例。</span></div></div><div id="f1tmKU7UGj8qDMrJMQobVH" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="f6dL8R8eCwHSRsWtzVSozZ" class="wolai-block wolai-text"><div><span class="inline-wrap">这也是为什么 nest 会用 ts 来写，因为它很依赖这个 </span><span class="inline-wrap"><b>emitDecoratorMetadata</b></span><span class="inline-wrap"> 的编译选项。</span></div></div><blockquote id="PQQ3ZJ943SdA7r1h8Xi7Y" class="wolai-block"><span class="gray inline-wrap">nest cli<span class="jill"></span>生成的模板是默认开启这个编译选项的。</span></blockquote><div id="2Xczw3J5tbg2pVoWnvhfu4" class="wolai-block wolai-text"><div><span class="inline-wrap">总结一下核心实现原理：</span><span class="inline-wrap"><b>通过装饰器给 class 或者对象添加 metadata，并且开启 ts 的 emitDecoratorMetadata 来自动添加类型相关的 metadata，然后运行的时候通过这些元数据来实现依赖的扫描，对象的创建等等功能。</b></span></div></div><div id="2HRMYXRMxutvhzVRdXPxrW" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="8mfWTajKvBgZeH9zhq3S5a" class="wolai-block"><span class="inline-wrap">自定义装饰器：</span><span class="inline-wrap"><b>@SetMetadata </b></span></h3><div id="Fag4iGXMHA8mEw2sruMoZ" class="wolai-block wolai-text"><div><span class="inline-wrap">Nest<span class="jill"></span>还提供了一个 </span><span class="inline-wrap"><code>@SetMetadata</code></span><span class="inline-wrap"> 的装饰器让我们可以自定义装饰器去给 class、method 添加一些 metadata;</span></div></div><div id="wtoqAPc1N2nisQJ8rFY6Hc" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 id="hGp8Fsdjjxs8gL9Lipc8Cr" class="wolai-block"><span class="inline-wrap">自定义装饰器的应用场景</span></h2><h4 id="ejhvTs7vWkGZDirXgXuXW4" class="wolai-block"><span class="inline-wrap">性能日志记录</span></h4><details id="m6GkkvhNzQo15kscykfbSD" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建 </span><span class="inline-wrap"><code>@PerformanceLogger()</code></span><span class="inline-wrap"> 装饰器</span></summary><code-block id="H8hF1QYNJgYBaZu7z2Quh" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// performance-logger.decorator.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> SetMetadata <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PERFORMANCE_LOGGER_KEY</span> <span class="token operator">=</span> <span class="token string">'performance-logger'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">PerformanceLogger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">SetMetadata</span><span class="token punctuation">(</span><span class="token constant">PERFORMANCE_LOGGER_KEY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><code-block id="vwrhj8CSdHhaqmBoT345Cr" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// performance-logger.interceptor.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CallHandler<span class="token punctuation">,</span> ExecutionContext<span class="token punctuation">,</span> Injectable<span class="token punctuation">,</span> NestInterceptor <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Observable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> tap <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceLoggerInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">NestInterceptor</span> <span class="token punctuation">&#123;</span>
  <span class="token function">intercept</span><span class="token punctuation">(</span>context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">,</span> next<span class="token operator">:</span> CallHandler<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> next
      <span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> requestTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request took </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>requestTime<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="cKSKGGAeKLnE58EqBFyApN" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">在控制器方法上应用，实现性能监控</span></summary><code-block id="94gdGB7uBMFbsQJffert4Y" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UseInterceptors <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> PerformanceLogger <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./performance-logger.decorator'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> PerformanceLoggerInterceptor <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./performance-logger.interceptor'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PerformanceLogger</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span>PerformanceLoggerInterceptor<span class="token punctuation">)</span>
  <span class="token function">getAdminData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Admin Data'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><h4 id="ac4r3X9dHoq6okvLrnrPH7" class="wolai-block"><span class="inline-wrap">权限验证</span></h4><details id="nZbddHrr5LKe98VwXKE2AY" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建 </span><span class="inline-wrap"><code>@RoleGuard(role: string)</code></span><span class="inline-wrap"> 装饰器</span></summary><code-block id="3giAs7wdxYsa2G8aEUpEQZ" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// role-guard.decorator.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> SetMetadata <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ROLE_GUARD_KEY</span> <span class="token operator">=</span> <span class="token string">'role-guard'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">RoleGuard</span> <span class="token operator">=</span> <span class="token punctuation">(</span>role<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">SetMetadata</span><span class="token punctuation">(</span><span class="token constant">ROLE_GUARD_KEY</span><span class="token punctuation">,</span> role<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><code-block id="4Fw9nhTenY7G7krNpZh3D3" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// role-guard.guard.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CanActivate<span class="token punctuation">,</span> ExecutionContext<span class="token punctuation">,</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Reflector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token constant">ROLE_GUARD_KEY</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./role-guard.decorator'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RoleGuard</span> <span class="token keyword">implements</span> <span class="token class-name">CanActivate</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> reflector<span class="token operator">:</span> Reflector<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token function">canActivate</span><span class="token punctuation">(</span>context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> requiredRole <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reflector<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token constant">ROLE_GUARD_KEY</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>requiredRole<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 如果没有设置角色要求，则允许访问</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">.</span>roles<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>requiredRole<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><details id="w3LwUHoCKJuypjR9NLp2v4" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">限制特定角色用户访问控制器方法</span></summary><code-block id="bZim51FL9ydRoZGAeTsvY3" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> UseGuards <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> RoleGuard <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./role-guard.guard'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> RoleGuard <span class="token keyword">as</span> RoleGuardDecorator <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./role-guard.decorator'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">RoleGuardDecorator</span></span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token comment">// 使用 @RoleGuard 装饰器设置角色要求</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UseGuards</span></span><span class="token punctuation">(</span>RoleGuard<span class="token punctuation">)</span> <span class="token comment">// 使用守卫进行权限检查</span>
  <span class="token function">getAdminData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'Admin Data'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block></details><h4 id="pmXxfc2GJhtbrGGzdMtsek" class="wolai-block"><span class="inline-wrap">参数装饰器</span></h4><details id="xrFKYH8voBGeoKN4Wwgwbv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建 </span><span class="inline-wrap"><code>@LogParams()</code></span><span class="inline-wrap"> 装饰器</span></summary><code-block id="hYV6yp8aEZhGjcJLYdAiic" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// log-params.decorator.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> SetMetadata<span class="token punctuation">,</span> createParamDecorator<span class="token punctuation">,</span> ExecutionContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">LOG_PARAMS_KEY</span> <span class="token operator">=</span> <span class="token string">'log-params'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> LogParams <span class="token operator">=</span> <span class="token function">createParamDecorator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Params: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre></div></code-block></details><details id="wftYw3cLLdAxxoCZRUhgVw" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">在控制器方法的参数上应用，实现参数日志记录</span></summary><code-block id="i3B7b5WvJRm1Sg17r79JhT" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token comment">// app.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Param <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> LogParams <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./log-params.decorator'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'user/:id'</span><span class="token punctuation">)</span>
  <span class="token function">getUserData</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">LogParams</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> params<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User Data for ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

</pre></div></code-block></details><h2 id="wzjHT7Pdfj9QJD2pj9iP9Y" class="wolai-block"><span class="inline-wrap">总结</span></h2><div id="owp5x1tLx7DeFoq6XyEuHS" class="wolai-block wolai-text"><div><span class="inline-wrap">Nest.js 的装饰器实现原理基于 TypeScript 提供的装饰器特性和 Reflect Metadata API。</span></div></div><div id="8ubegyqcX3VhJWrQqtcq9K" class="wolai-block wolai-text"><div><span class="inline-wrap">通过在类、方法等上添加元数据，去实现了依赖注入、路由映射等功能。</span></div></div><div id="3dWhVjcR1bKjFBfFpccDFH" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是主要的实现原理要点：</span></div></div><ol class="wolai-block"><li id="7McpACECUM15q9VjbFyrtd"><div class="marker"></div><span class="inline-wrap"><b>Reflect Metadata API:</b></span><span class="inline-wrap"> Nest<span class="jill"></span>使用 Reflect Metadata API 提供的 </span><span class="inline-wrap"><code>Reflect.getMetadata</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>Reflect.defineMetadata</code></span><span class="inline-wrap"> 等方法来动态添加和获取元数据，包含了装饰器在类、方法等上的信息。</span></li><li id="29hysMeGnWRkYMLaCz1fpa"><div class="marker"></div><span class="inline-wrap"><b>依赖注入:</b></span><span class="inline-wrap"> Nest<span class="jill"></span>中所有的装饰器都使用 Reflect Metadata 来添加元数据，以便在初始化阶段进行依赖扫描和注入。Nest.js 利用这些元数据实现了依赖注入。</span></li><li id="7MXrruDSWG6HGDQQyf1krA"><div class="marker"></div><span class="inline-wrap"><b>emitDecoratorMetadata 选项:</b></span><span class="inline-wrap"> TypeScript 提供了 </span><span class="inline-wrap"><code>emitDecoratorMetadata</code></span><span class="inline-wrap"> 编译选项，开启后会自动为装饰器添加一些元数据，包括 </span><span class="inline-wrap"><code>design:type</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>design:paramtypes</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>design:returntype</code></span><span class="inline-wrap">。这些元数据用于识别类、方法的类型信息，帮助在运行时进行实例化和注入。</span></li><li id="7f1DzjgNkAQSp8sVG7mLou"><div class="marker"></div><span class="inline-wrap"><b>@SetMetadata 装饰器:</b></span><span class="inline-wrap"> Nest.js 还提供了 </span><span class="inline-wrap"><code>@SetMetadata</code></span><span class="inline-wrap"> 装饰器，允许我们自定义装饰器，在控制器的类和方法上添加自定义的元数据，再从拦截器和守卫中通过 </span><span class="inline-wrap"><code>reflector</code></span><span class="inline-wrap"> 的 API 取出来进行相应的处理。</span></li></ol><div id="q6xWBPfpMzWNUJSr7MDCxZ" class="wolai-block wolai-text"><div><span class="inline-wrap">通过理解这些概念，可以更好地理解 Nest.js 中装饰器的工作原理和如何实现依赖注入、路由映射等功能。</span></div></div><div id="5FoqNek3vuxpoJo92jveZp" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="m5rQqTjKpaCkHRoTRWj84B" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="rGEo6es7WjJTbNis73kK16" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html>
        
      </div>

         
    </div>
    
     
  </div>
  
    

  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2023 Huangjiexin<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
