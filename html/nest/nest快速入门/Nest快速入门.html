<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="Nest快速入门 - wolai 笔记背景全栈发展全栈对公司和个人都大有益处，但最重要的还是对个人的发展如何。个人发展全栈主要还是为了应对未来，主要有几方面： 避免被淘汰、 提升个人价值、 走向管理职位、 实现创业梦。 从个人为出发点，后端语言百花齐放，想要到一个比较深入的程度，那对所使用的开发语言、框架就需要稍微深入了。例如同时要深入typescript、Java的领域，那就会谈到精力问题，对">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/html/nest/nest%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/Nest%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Nest快速入门 - wolai 笔记背景全栈发展全栈对公司和个人都大有益处，但最重要的还是对个人的发展如何。个人发展全栈主要还是为了应对未来，主要有几方面： 避免被淘汰、 提升个人价值、 走向管理职位、 实现创业梦。 从个人为出发点，后端语言百花齐放，想要到一个比较深入的程度，那对所使用的开发语言、框架就需要稍微深入了。例如同时要深入typescript、Java的领域，那就会谈到精力问题，对">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21771732/1676175485415-b4298c68-ff05-46de-8abc-ee7e74de4962.png#averageHue=%23232425&amp;clientId=u31848435-c35d-4&amp;from=paste&amp;height=231&amp;id=r8Kpi&amp;name=image.png&amp;originHeight=136&amp;originWidth=226&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=8527&amp;status=done&amp;style=none&amp;taskId=u260e6f9f-ef8f-4ac3-912f-1f04d640f74&amp;title=&amp;width=384">
<meta property="og:image" content="http://example.com/html/nest/nest%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/media/nest%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png">
<meta property="article:published_time" content="2023-12-11T04:23:18.982Z">
<meta property="article:modified_time" content="2023-12-11T04:23:18.982Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2023/png/21771732/1676175485415-b4298c68-ff05-46de-8abc-ee7e74de4962.png#averageHue=%23232425&amp;clientId=u31848435-c35d-4&amp;from=paste&amp;height=231&amp;id=r8Kpi&amp;name=image.png&amp;originHeight=136&amp;originWidth=226&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=8527&amp;status=done&amp;style=none&amp;taskId=u260e6f9f-ef8f-4ac3-912f-1f04d640f74&amp;title=&amp;width=384">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/assets/images/banner.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Hexo </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
      <a class="main-nav-link" href="/html/nest">Nest</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
      <a class="nav-dropdown-link" href="/html/nest">Nest</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Huangjiexin </div>
      <div class="dot"></div>
      <div class="subtitle">nothing </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      



    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="page-" class="h-entry article article-type-page" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        Untitled
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2023-12-11T04:23:18.982Z" itemprop="datePublished">2023-12-11</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
    Uncategorized 
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            21k words 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>Nest快速入门 - wolai 笔记</title><link rel="shortcut icon" href="media/icon_1.svg"></link></head><body class="more-lead"><header><div class="image has" style="background-position-y: 50%; background-image: url(&quot;https://cdn.wostatic.cn/cover/watercolor/3VMGfCa8UCpJ4Dy36jMNKa.jpg&quot;)"></div><div class="title"><div class="banner"><div class="icon icon-image" style="background-image: url(&quot;media/icon.svg&quot;)"></div></div><div data-title="Nest快速入门" class="main-title"></div></div></header><article><h2 id="a1uYtFztFiFWjQkag7tYSF" class="wolai-block"><span class="inline-wrap">背景</span></h2><h3 id="2iiyyJ4VXgZxP7VYJ3TJEe" class="wolai-block"><span class="inline-wrap">全栈</span></h3><div id="rNfBe4qzEvxuvxE2XEbazd" class="wolai-block wolai-text"><div><span class="red inline-wrap">发展全栈</span><span class="inline-wrap">对公司和个人都大有益处，但最重要的还是对个人的发展如何。个人发展全栈主要还是为了应对未来，主要有几方面： 避免被淘汰、 提升个人价值、 走向管理职位、 实现创业梦。
从个人为出发点，后端语言百花齐放，想要到一个比较深入的程度，那对所使用的开发语言、框架就需要稍微深入了。例如同时要深入<span class="jill"></span>typescript、Java<span class="jill"></span>的领域，那就会谈到精力问题，对个人来说似乎会很累，不太现实。</span></div></div><div id="dNVX1Zw72DNunVMHVer1Bv" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="vTj3PN5xW51TBHb1gAfTJE" class="wolai-block"><span class="inline-wrap">NestJS</span></h3><div id="mFMJbA7fiswLxZFxjs6sCR" class="wolai-block wolai-text"><div><span class="inline-wrap">根据官网介绍：</span></div></div><blockquote id="csa4o4BUrgL7sYwrwviWQ9" class="wolai-block"><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://docs.nestjs.cn/9/introduction"><span class="red">Nest (NestJS)</span></a></span><span class="inline-wrap"> 是一个用于构建高效、可扩展的</span><span class="blue inline-wrap"> </span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://nodejs.org/en/"><span class="blue">Node.js</span></a></span><span class="inline-wrap"> 服务器端应用程序的开发框架。它利用<span class="jill"></span>JavaScript 的渐进增强的能力，使用并完全支持 </span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/"><span class="blue">TypeScript</span></a></span><span class="inline-wrap"> （仍然允许开发者使用纯 JavaScript 进行开发），并结合了 OOP （面向对象编程）、FP （函数式编程）和 FRP （函数响应式编程）。</span></blockquote><div id="2t7XfBkTDUDuUnVXQyJEov" class="wolai-block wolai-text"><div><span class="red inline-wrap">NestJS</span><span class="inline-wrap"> 的一些</span><span class="inline-wrap"><b>优势</b></span><span class="inline-wrap">包括：</span></div></div><ul class="wolai-block"><li id="x26B2f6QXtw18djiHcyCUz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">构建在现代 JavaScript 栈之上，完全支持 TypeScript。</span></li><li id="f8gyHZnWYUSR6Gp7bA3r3X"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">基于 TypeScript，提供了</span><span class="inline-wrap"><b>强类型和静态类型检查</b></span><span class="inline-wrap">。</span></li><li id="dYvG1ygHryQbL6nZ3ZX7NQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">基于 Angular 的架构和语法，提供了强大的</span><span class="inline-wrap"><b>模块化</b></span><span class="inline-wrap">系统和</span><span class="inline-wrap"><b>依赖注入</b></span><span class="inline-wrap">功能。</span></li><li id="fqW4pZS4g6LKE8WuhcqZCH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">提供了丰富的工具和模块，可用于构建各种类型的服务器端应用程序，包括 </span><span class="inline-wrap"><b>RESTful API</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>GraphQL API</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>WebSocket 服务器</b></span><span class="inline-wrap">等。</span></li><li id="8kbkCtiNrFD1mDah6Na1ZT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">提供了一组可扩展的构建块，可用于快速构建应用程序。</span></li><li id="53cv5CExTcPbShMUZrfcAw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">提供了与</span><span class="inline-wrap"><b>主流数据库和身份验证系统</b></span><span class="inline-wrap">的集成。</span></li></ul><div id="aMYXzPgbgRtY9UwbN7JRKb" class="wolai-block wolai-text"><div><span class="inline-wrap">对于前端人员来说，“一招<span class="jill"></span>Typescript”吃遍前后端，何乐而不为。</span></div></div><div id="t1Kny6NdW3D3gAPFy5UZza" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 id="gfWAckkx1vMWubhqGyKCi8" class="wolai-block"><span class="inline-wrap">前期准备</span></h2><h3 id="fYdFXJXZ5USEMGwLepasPa" class="wolai-block"><span class="inline-wrap">项目初始化</span></h3><div id="f4sTWj3XAtj7MrfMK18oMY" class="wolai-block wolai-text"><div><span class="inline-wrap">确保已经安装了 </span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://nodejs.org/"><span>Node.js</span></a></span><span class="inline-wrap">（版本 &gt;= 12，v13 除外）</span></div></div><code-block id="mFKWA1ZpgZ6w69BXSdCdmo" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>$ <span class="token function">npm</span> i <span class="token parameter variable">-g</span> @nestjs/cli 
$ nest new project-name</pre></div></code-block><h3 id="27GR4p5NSjNFuhDYmGFh81" class="wolai-block"><span class="inline-wrap">运行项目</span></h3><div id="8e1JnYkDG4KG7Vbd8R1mBo" class="wolai-block wolai-text"><div><span class="inline-wrap">启动 HTTP 服务监听定义在 src/main.ts 文件中定义的端口号。在浏览器访问</span><span class="inline-wrap"><code>[http://localhost:3000](http://localhost:3000/)/</code></span><span class="inline-wrap">，访问成功代表服务已经<span class="jill"></span>OK<span class="jill"></span>了；</span></div></div><code-block id="xz5ySJsu6vB8JXeeD69bxj" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># dev为热更新模式</span>
$ <span class="token function">npm</span> run start:dev</pre></div></code-block><div id="7VgkYyTik3S3XVZaSH8MJM" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="hR2z7zBQpPyDK4NWaTWpip" class="wolai-block"><span class="inline-wrap">框架约束</span></h3><div id="4XZve4qTxCGbkdAEzojv8u" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>NestJS<span class="jill"></span>文件约束：</b></span></div></div><ul class="wolai-block"><li id="9uMYBrKqn82mq54BYEy5sC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">每个模块最少有三种文件组合：</span><span class="inline-wrap"><b>module</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>server</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>controller</b></span><span class="inline-wrap">。</span></li><li id="rTDPDGyPgdZvs9HUviSrvm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">具有同一</span><span class="inline-wrap"><b>应用程序域</b></span><span class="inline-wrap">的文件应该放到同一个</span><span class="inline-wrap"><b>功能模块</b></span><span class="inline-wrap">下。</span></li><li id="gybWw8KrcrL7uhanYCbab2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">NestJS<span class="jill"></span>允许命令行创建不生成</span><span class="inline-wrap"><code>.spec</code></span><span class="inline-wrap">(</span><span class="inline-wrap"><code>nest g controller product --no-spec</code></span><span class="inline-wrap">)。</span></li></ul><div id="vTu8EN1DrNwGGfs9DqDNc3" class="wolai-block wolai-text"><div><span class="inline-wrap">初始化后项目的</span><span class="inline-wrap"><b>主要</b></span><span class="inline-wrap">目录结构：</span></div></div><div id="1djLGgWgtPj97LG6GLjLaE" class="wolai-block"><figure class="wolai-left" style="width: 100%"><img src="https://cdn.nlark.com/yuque/0/2023/png/21771732/1676175485415-b4298c68-ff05-46de-8abc-ee7e74de4962.png#averageHue=%23232425&amp;clientId=u31848435-c35d-4&amp;from=paste&amp;height=231&amp;id=r8Kpi&amp;name=image.png&amp;originHeight=136&amp;originWidth=226&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=8527&amp;status=done&amp;style=none&amp;taskId=u260e6f9f-ef8f-4ac3-912f-1f04d640f74&amp;title=&amp;width=384" style="width: 350px"/></figure></div><div id="bggoUcy6VZvLdMzDEf5YgT" class="wolai-block wolai-text"><div><span class="inline-wrap">
这里涉及到<span class="jill"></span>NestJs<span class="jill"></span>框架的文件约束：</span></div></div><div id="jRke5GJNYEuQUZRWiX8bne" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 370px"><span class="inline-wrap">app.controller.ts</span></th><th style="width: 370px"><span class="inline-wrap">单个路由的基本控制器(Controller)</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">app.controller.spec.ts</span></td><td><span class="inline-wrap">针对控制器的单元测试</span></td></tr><tr><td><span class="inline-wrap">app.module.ts</span></td><td><span class="inline-wrap">应用程序的根模块(Module)</span></td></tr><tr><td><span class="inline-wrap">app.service.ts</span></td><td><span class="inline-wrap">具有单一方法的基本服务(Service)</span></td></tr><tr><td><span class="inline-wrap">main.ts</span></td><td><span class="inline-wrap">应用程序的入口文件，它使用核心函数 NestFactory 来创建 Nest 应用程序的实例。</span></td></tr></tbody></table></div><div id="rV2f48p1L2kPwgsrb4ibVf" class="wolai-block wolai-text"><div><span class="inline-wrap">在</span><span class="inline-wrap"><code>main.ts</code></span><span class="inline-wrap">中使用工厂函数</span><span class="inline-wrap"><code>NestFactory</code></span><span class="inline-wrap">创建一个 </span><span class="inline-wrap"><code>AppModule</code></span><span class="inline-wrap"> 应用实例，启动 HTTP 监听器，等待 HTTP 请求。</span></div></div><code-block id="2zVyJ5Zj9Gc1KtqLKmGg5v" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NestFactory <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NestExpressApplication <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/platform-express'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// &lt;NestExpressApplication> ｜ &lt;NestFastifyApplication> | &lt;></span>
  <span class="token comment">// 一般来说我们选择 NestExpress，因为网上资源多，官方文档有很多例子都是基于Express</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span>NestExpressApplication<span class="token operator">></span></span></span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置全局路由前缀</span>
  <span class="token comment">// app.setGlobalPrefix('api');</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><details id="oENuQB9kWyuNtBn3iuWeRq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">可选平台</span></summary><ul class="wolai-block"><li id="jcM4g8n6NCYGMaBAXSJ1V8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://expressjs.com/"><span>Express</span></a></span><span class="inline-wrap"> 是一个众所周知的 node.js 简约 Web 框架。 这是一个经过实战考验，适用于生产的库，拥有大量社区资源。 默认情况下使用 @nestjs/platform-express 包。许多用户都可以使用 Express ，并且无需采取任何操作即可启用它。</span></li><li id="xL5xdwkuFqYuvSxN53cDC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://www.fastify.io/"><span>Fastify</span></a></span><span class="inline-wrap"> 是一个高性能，低开销的框架，专注于提供最高的效率和速度。 在</span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://docs.nestjs.cn/8/techniques?id=性能（fastify）"><span>这里</span></a></span><span class="inline-wrap">
阅读如何使用它。</span></li></ul></details><div id="2TfvXszk3zPuSJSuoUvV1a" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="oFsM1zTaWu6mkwgrVcmsT4" class="wolai-block"><span class="inline-wrap">工作流程</span></h3><div id="phcgqypcfvXSQL2PgMGqiM" class="wolai-block wolai-text"><div><span class="inline-wrap">在开始之前，不妨先看一下 Nest 的工作流程：</span></div></div><div id="s8gPx96gyGdKv3uajmm4Z4" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/nest%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" style="width: 623px"/></figure></div><div id="jfvXdPDg8ZhaGcZ265MTXb" class="wolai-block wolai-text"><div><span class="inline-wrap">整个请求的过程如上图所示，正常情况下提供者组件都以</span><span class="inline-wrap"><b>全局第一</b></span><span class="inline-wrap">顺序执行的原则，而过滤器则相反，会从最底层开始处理，即路由→控制器→全局。</span></div></div><div id="skRhpCWNtaPD1hWvzRyShU" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 id="6zBjY2FBSyoNJ3XX3rVxb1" class="wolai-block"><span class="inline-wrap">基础概念</span></h2><h3 id="hmYZ962ZGum1RFZKAtsWCk" class="wolai-block"><span class="inline-wrap">模块</span></h3><aside id="fWXgHuLtRLCW1qqHj3Sxuh" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">模块是用 </span><span class="inline-wrap"><code>@Module()</code></span><span class="inline-wrap"> 装饰的类。 </span><span class="inline-wrap"><code>@Module()</code></span><span class="inline-wrap"> 装饰器提供了元数据，Nest 用它来组织应用程序结构。</span></aside><div id="dB289MjQc5vNitMLAUWHgD" class="wolai-block wolai-text"><div><span class="inline-wrap">模块主要分<span class="jill"></span>4<span class="jill"></span>种：</span></div></div><ol class="wolai-block"><li id="1DpNdvQWj9EahKJXEEepFS"><div class="marker"></div><span class="inline-wrap">功能模块</span></li><li id="ah6VB7pjpePaGbp4DERt1L"><div class="marker"></div><span class="inline-wrap">共享模块</span></li><li id="m5k5fNL9kiHZFm4iAoEPQB"><div class="marker"></div><span class="inline-wrap">全局模块</span></li><li id="8miLPP9z4vaNjrMURbn6JT"><div class="marker"></div><span class="inline-wrap">动态模块</span></li></ol><div id="swxK5XbJrZqcMaFke43iPk" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>main.ts</code></span><span class="inline-wrap"> 只引入了</span><span class="inline-wrap"><code>app.module.ts</code></span><span class="inline-wrap">文件，此为应用程序的根模块(每个 Nest 应用程序至少有一个模块)：</span></div></div><code-block id="cbUuD1wnyPqUNWZovjYCzq" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
</pre></div></code-block><blockquote id="vseGVCvR5BTjHLiAZactLz" class="wolai-block"><span class="inline-wrap">对装饰器不了解的，可以看</span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://juejin.cn/post/6859314697204662279#heading-2"><span>走近<span class="jill"></span>MidwayJS：初识<span class="jill"></span>TS<span class="jill"></span>装饰器与<span class="jill"></span>IoC<span class="jill"></span>机制</span></a></span></blockquote><div id="sG5SX3DZsTx8XT9BgzhwR4" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>@Module()</code></span><span class="inline-wrap">装饰器接收四个属性：</span><span class="inline-wrap"><code>providers</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>controllers</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>imports</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>exports</code></span><span class="inline-wrap">。</span></div></div><div id="2VBB1rY6YW1e9u3U4MZQAi" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 173px"><span class="inline-wrap"><code>providers</code></span></th><th style="width: 561px"><span class="inline-wrap">Nest.js<span class="jill"></span>注入器实例化的提供者（服务提供者），处理具体的业务逻辑，各个模块之间可以共享；</span></th></tr></thead><tbody><tr><td><span class="inline-wrap"><code>controllers</code></span></td><td><span class="inline-wrap">处理<span class="jill"></span>http<span class="jill"></span>请求，包括路由控制，向客户端返回响应，将具体业务逻辑委托给<span class="jill"></span>providers<span class="jill"></span>处理；</span></td></tr><tr><td><span class="inline-wrap"><code>imports</code></span></td><td><span class="inline-wrap">导入模块的列表，如果需要使用其他模块的服务，需要通过这里导入；</span></td></tr><tr><td><span class="inline-wrap"><code>exports</code></span></td><td><span class="inline-wrap">导出服务的列表，供其他模块导入使用。如果希望当前模块下的服务可以被其他模块共享，需要在这里配置导出；</span></td></tr></tbody></table></div><div id="omBzRKQVUWmuM3HNYPpxyK" class="wolai-block wolai-text"><div><span class="inline-wrap">下面通过一个产品的<span class="jill"></span>CRUD<span class="jill"></span>例子来进行演示：</span></div></div><div id="jD3WK7TEnYZQA2viyPemkE" class="wolai-block wolai-text"><div><span class="inline-wrap">NestJs<span class="jill"></span>中，具有同一</span><span class="inline-wrap"><b>应用程序域</b></span><span class="inline-wrap">的文件应该放到同一个</span><span class="inline-wrap"><b>功能模块</b></span><span class="inline-wrap">下：
首先我们可以通过<span class="jill"></span>nest-cli<span class="jill"></span>提供的命令生成模块:</span></div></div><ul class="wolai-block"><li id="3j7Xowd15z596hM6Xvsad1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>nest g module products</code></span></li></ul><code-block id="xnqKdNQD5C2i29oeUV1YT5" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block><div id="vHYj4xDXmoeouCbyWTuhUk" class="wolai-block wolai-text"><div><span class="inline-wrap">同时 </span><span class="inline-wrap"><b>ProductsModule</b></span><span class="inline-wrap"> 也会被自动注册到根模块：</span></div></div><code-block id="bLLkubnsadm6D3gCYsKXBJ" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ProductsModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./products/products.module'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>ProductsModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block><div id="kQDnu61E1bMjr2AYjeFQkh" class="wolai-block wolai-text"><div><span class="inline-wrap">这样便完成了一个新的功能模块的注册。</span></div></div><details id="baDsYanmXFZmawKW3uZY4C" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">共享模块</span></summary><div id="euyBAoUFoWW3vte4CsZRau" class="wolai-block wolai-text"><div><span class="inline-wrap">在 Nest 中，默认情况下，模块是</span><span class="inline-wrap"><b>单例</b></span><span class="inline-wrap">的，因此我们可以轻松地在多个模块之间共享</span><span class="inline-wrap"><b>同一个提供者实例</b></span><span class="inline-wrap">。模块本身存在</span><span class="inline-wrap"><b>共享性，</b></span><span class="inline-wrap"> 一个模块一旦创建便可以被任意模块重复使用。例如：</span></div></div><code-block id="nw7TzB8MSkHSVfsLon9zru" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CatsController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./cats.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CatsService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./cats.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>CatsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>CatsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 导出模块供其他模块倒入，所有模块共享catsService实例</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsService<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block></details><details id="qYVqSPXtXLbDAn4gJJUnWA" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">全局模块</span></summary><div id="v9vw5N3wkGuLHXiYmMZZz4" class="wolai-block wolai-text"><div><span class="inline-wrap">如果想提供一些通用的模块，如：helper，数据库连接等等，可以创建全局模块，也比较简单，增加</span><span class="inline-wrap"><code>@Global</code></span><span class="inline-wrap">即可，全局模块应该只注册一次，最好由根或核心模块注册。</span></div></div><code-block id="k5ofsFrfpW73wfZJwUevGz" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module<span class="token punctuation">,</span> Global <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CatsController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./cats.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CatsService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./cats.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Global</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>CatsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>CatsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block></details><details id="v8PRgFFSfSFVUKiyDENMYE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">动态模块</span></summary><div id="gxavGczvAKZm9TgRei3QV6" class="wolai-block wolai-text"><div><span class="inline-wrap">动态模块在 Nest 中也是非常重要的。此功能使您可以轻松创建可自定义的模块，这些模块可以动态注册和配置提供程序。例如：注册动态模块：</span><span class="inline-wrap"><code>DatabaseModule</code></span></div></div><code-block id="tzLFeHfN5pwoSAZ7texrid" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module<span class="token punctuation">,</span> DynamicModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createDatabaseProviders <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./database.providers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Connection <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./connection.provider'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>Connection<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseModule</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token function">forRoot</span><span class="token punctuation">(</span>entities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> DynamicModule <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> providers <span class="token operator">=</span> <span class="token function">createDatabaseProviders</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      module<span class="token operator">:</span> DatabaseModule<span class="token punctuation">,</span>
      providers<span class="token operator">:</span> providers<span class="token punctuation">,</span>
      exports<span class="token operator">:</span> providers<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></pre></div></code-block><div id="wsiaZW9ERDPEpyNWJ9o1ct" class="wolai-block wolai-text"><div><span class="inline-wrap">使用该模块</span></div></div><code-block id="jfFEsHvBAZRKPePid8MMbe" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> DatabaseModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./database/database.module'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> User <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./users/entities/user.entity'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>DatabaseModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block></details><div id="3zLBwbLKVc2kyFZGPWR2H6" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="fkBxHS4Cwjg7YytF3h2JmB" class="wolai-block"><span class="inline-wrap">控制器</span></h3><div id="aVofQxHeGr29Wn7DDnaFoR" class="wolai-block wolai-text"><div><span class="inline-wrap">同样的，通过<span class="jill"></span>nest-cli<span class="jill"></span>提供的命令生成控制器:</span></div></div><ul class="wolai-block"><li id="99RTU8gciASTX9pz1riv7C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>nest g controller products</code></span></li></ul><blockquote id="5HXKVBNFHsMKGjsBu7K8mQ" class="wolai-block"><span class="inline-wrap">在<span class="jill"></span>Nest<span class="jill"></span>中，使用装饰器</span><span class="inline-wrap"><code>@Controller()</code></span><span class="inline-wrap">定义一个基本的控制器，该装饰器可以传入一个路径参数</span></blockquote><code-block id="ndFQZZyoCX6i9eBidw3rDB" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Controller <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'products'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 下一步生成服务提供者后需要注入控制器</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> productsService<span class="token operator">:</span> ProductsService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></pre></div></code-block><div id="ufkgyV3TVBCiLB9uTYhCXL" class="wolai-block wolai-text"><div><span class="inline-wrap">同时在 </span><span class="inline-wrap"><code>products.module.ts</code></span><span class="inline-wrap">文件中会自动注册 ProductsController。</span></div></div><div id="uXWJqcFCLGGKCUzzpxm2d7" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="1MT8Pn8Q1pu1TnUw3UrsgN" class="wolai-block"><span class="inline-wrap">服务</span></h3><div id="m7eTjTbuKUCEMePeo2op5T" class="wolai-block wolai-text"><div><span class="inline-wrap">一样的操作，使用命令生成</span></div></div><ul class="wolai-block"><li id="qT8A69NxdVE4LitWSq18gt"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>nest g service products</code></span></li></ul><blockquote id="5yXzeJjh3sQQvRkdB8d174" class="wolai-block"><span class="inline-wrap">其实可以通过 </span><span class="inline-wrap"><code>nest g resource products</code></span><span class="inline-wrap">一次性生成。
更多创建命令可以通过 </span><span class="inline-wrap"><code>nest generate --help</code></span><span class="inline-wrap">查看。</span></blockquote><code-block id="7hNmcZjBRM6Lf3DwwCJLKg" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsService</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block><div id="1H8c2jJLye8wyxhLrFTSJG" class="wolai-block wolai-text"><div><span class="inline-wrap">此时的 products.module.ts 文件</span></div></div><code-block id="xbLr6rWMcMVjx45eAT1iJX" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ProductsController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./products.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ProductsService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./products.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>ProductsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>ProductsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block><div id="hjvefEsX7pXJs2BGuRbFYX" class="wolai-block wolai-text"><div><span class="inline-wrap">到目前为止，已经完成了 </span><span class="inline-wrap"><code>Products</code></span><span class="inline-wrap"> 功能模块的搭建。接下来了解一下上面的操作，Nest<span class="jill"></span>帮我们做了什么？</span></div></div><div id="wJsRr2QHLxqdw4EWAm5qs4" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="4JTe9tdnKAuXwmL7N2ZKeF" class="wolai-block"><span class="inline-wrap">依赖注入</span></h3><aside id="t8R5k2spMpnHQn2JpTmLKK" class="bg-cultured wolai-block"><div data-symbol="🚗" class="icon"></div><span class="inline-wrap">上面我们大概认识了</span><span class="red inline-wrap">Nest</span><span class="inline-wrap">的</span><span class="inline-wrap"><b>模块化</b></span><span class="inline-wrap">，那</span><span class="red inline-wrap"> Nest </span><span class="inline-wrap">的</span><span class="inline-wrap"><b>依赖注入</b></span><span class="inline-wrap">又是怎样的呢？</span></aside><div id="rK5FcPgrKFNnuCNrgzTc7D" class="wolai-block wolai-text"><div><span class="inline-wrap"> 先回顾一下之前的大致操作：</span></div></div><ol class="wolai-block"><li id="3mETwFcPD5AELb2yrSFew5"><div class="marker"></div><span class="inline-wrap">在</span><span class="inline-wrap"><code>products.service.ts</code></span><span class="inline-wrap">中，装饰器</span><span class="inline-wrap"><code>@Injectable()</code></span><span class="inline-wrap">将类</span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap">标记为可以被<span class="jill"></span>Nest IoC<span class="jill"></span>容器管理的类。</span></li><li id="wPC3nNME6Jxeg8zzmcRjQh"><div class="marker"></div><span class="inline-wrap">在</span><span class="inline-wrap"><code>products.controller.ts</code></span><span class="inline-wrap"> 中，</span><span class="inline-wrap"><code>ProductsController</code></span><span class="inline-wrap"> 通过构造函数注入声明对</span><span class="inline-wrap"><code>CatsService</code></span><span class="inline-wrap">的依赖：</span><code-block id="5eUm8RXgNVLUbLfngbEGW2" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> productsService<span class="token operator">:</span> ProductsService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></pre></div></code-block></li><li id="caiFZSs1bYpHRSe1ZAcTgW"><div class="marker"></div><span class="inline-wrap">在</span><span class="inline-wrap"><code>products.module.ts</code></span><span class="inline-wrap">模块（ IoC 容器）中注册提供者。</span><code-block id="9Qf1rA2r4PnJ9hMwifZaoz" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>ProductsController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>ProductsService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></div></code-block></li></ol><div id="jVZ14ge29sf1b7EAomH4gG" class="wolai-block wolai-text"><div><span class="inline-wrap">这个过程是<span class="jill"></span>Nest 是如何处理的：</span></div></div><div id="qEUB79D8hwZNYwzow2wcFK" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="rPFYyg9a6aQK71pDpgxvcy" class="wolai-block wolai-text"><div><span class="inline-wrap">当 Nest IoC 容器实例化 </span><span class="red inline-wrap">ProductsController </span><span class="inline-wrap">时，它首先查找任何依赖项。当它找到 </span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap"> 依赖项时，它会对 </span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap"> 令牌执行查找，根据注册步骤（第<span class="jill"></span>3）返回 </span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap"> 类。</span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap">假设 </span><span class="inline-wrap"><code>SINGLETON</code></span><span class="inline-wrap"> 作用域（默认行为），Nest 将创建一个 </span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap"> 实例，缓存它并返回它，或者如果已经缓存了一个实例，则返回现有实例。</span></div></div><blockquote id="bFtMPbZfGY21bLYDS521Tm" class="wolai-block"><span class="inline-wrap">事实上，语法</span><span class="inline-wrap"><code>providers: [ProductsService]</code></span><span class="inline-wrap"> 是更完整语法的简写：</span><code-block id="db4Kb3GTLNoTXkxCjSgGUk" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre>providers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
  provide<span class="token operator">:</span> ProductsService<span class="token punctuation">,</span>
  useClass<span class="token operator">:</span> ProductsService<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></div></code-block><div id="nY8xtmJrzQJRc47FdJ9jZ9" class="wolai-block wolai-text"><div><span class="inline-wrap">现在我们看到了这个显式构造，我们可以了解注册过程。在这里，我们清楚地将令牌<span class="jill"></span>ProductsService<span class="jill"></span>与</span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap">相关联。</span><span class="inline-wrap"><code>ProductsService</code></span><span class="inline-wrap">速记符号只是为了简化最常见的用例，其中令牌用于请求具有</span><span class="inline-wrap"><b>相同名称的类</b></span><span class="inline-wrap">的实例。</span></div></div></blockquote><div id="2wLN9fQd4RzadisGGt4cyQ" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 id="88o2MQFdRi242G6No8QFYy" class="wolai-block"><span class="inline-wrap">核心概念</span></h2><div id="rSup3o9c1JPyMgLvUmcAhs" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来围绕业务来介绍其他几个核心概念，在这之前，先来了解一下 </span><span class="inline-wrap"><b>NestJS</b></span><span class="inline-wrap"> 如何接入数据库。</span></div></div><h3 id="8PacdTkzmhJrmTHQEQJ3BE" class="wolai-block"><span class="inline-wrap">数据库</span></h3><div id="wqA7Z9BrQVSQsoAxmjXwJx" class="wolai-block wolai-text"><div><span class="inline-wrap">这里以</span><span class="inline-wrap"><b>TypeORM<span class="jill"></span>框架</b></span><span class="inline-wrap">为例与<span class="jill"></span>MySQL<span class="jill"></span>数据库进行交互。</span></div></div><blockquote id="6T2QEySC3NLyekC89RZek4" class="wolai-block"><span class="inline-wrap">ORM<span class="jill"></span>技术（Object-Relational Mapping）,把关系数据库的变结构映射到对象上。</span></blockquote><div id="pVHfUECp1UVhRrhuZSdBtB" class="wolai-block wolai-text"><div><span class="inline-wrap">安装依赖：</span></div></div><code-block id="x9shieZiit8X7JJZGk2Yze" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">npm</span> <span class="token function">install</span> @nestjs/typeorm typeorm mysql2 <span class="token parameter variable">-S</span></pre></div></code-block><div id="t9NqEiVt4KKHETEAjSbAzA" class="wolai-block wolai-text"><div><span class="inline-wrap">在 app.module.ts 中注册：</span></div></div><code-block id="oo1brk5EE7KP61RueGPvMt" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Module <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> TypeOrmModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppController <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AppService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ProductsModule <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./products/products.module'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    ProductsModule<span class="token punctuation">,</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      type<span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
      host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
      username<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
      password<span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
      database<span class="token operator">:</span> <span class="token string">'store'</span><span class="token punctuation">,</span>
      autoLoadEntities<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动加载实体</span>
      synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="xqeMoecUQKU2gcr9Vet5MC" class="wolai-block wolai-text"><div><span class="inline-wrap">这是最简单的配置方式，当然 **TypeORM **也非常方便地支持：</span></div></div><ul class="wolai-block"><li id="imBZdVmoVYP63draomysvG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">存储库模式</span><ul class="wolai-block"><li id="xpsF59KPPiuLyVFRZisFsY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">每个实体都有自己的存储库<span class="jill"></span>Entity。</span></li></ul></li><li id="bPLHW6RB66AKSvK9SHJ5jE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">实体关系</span><ul class="wolai-block"><li id="7pgTFQK7DVUyyFZn1F8SXE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">一对一</span><span class="inline-wrap"><code>@OneToOne()</code></span><span class="inline-wrap">，一对多</span><span class="inline-wrap"><code>@OneToMany()</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>@ManyToOne()</code></span><span class="inline-wrap">，多对多</span><span class="inline-wrap"><code>@ManyToMany()</code></span></li></ul></li><li id="bTwdqug4H6vUdzcrkZFgij"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">自动载入实体</span></li><li id="owh5nhB7i5m1oNyeT6ajhN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">事务</span></li><li id="bB3jo9MYEJC3YSG36jfyiB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">多数据库</span></li><li id="19WF656LVus4GGmAWRgTHg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">异步配置</span></li><li id="gMTJHqE4p2ZhBVeq51DaEf"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">等等</span></li></ul><div id="wVAjtxjG6J1fwegi6eAw4L" class="wolai-block wolai-text"><div><span class="inline-wrap">详细可参考</span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://docs.nestjs.cn/8/techniques?id=数据库"><span>官方文档</span></a></span><span class="inline-wrap">。</span></div></div><div id="pYSxj9qczvtvKR1x2J6eyi" class="wolai-block wolai-text"><div><span class="inline-wrap">对了，不忘创建一下 </span><span class="inline-wrap"><code>Products</code></span><span class="inline-wrap"> 的实体类；</span></div></div><code-block id="1DiNRwS15WPcvirUZHxVM9" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Column<span class="token punctuation">,</span> Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token string">'products'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsEntity</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PrimaryGeneratedColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 标记为主列，值自动生成</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> length<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span>
  desc<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  thumb_url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token string">'tinyint'</span><span class="token punctuation">)</span>
  type<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'timestamp'</span><span class="token punctuation">,</span> <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'CURRENT_TIMESTAMP'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  create_time<span class="token operator">:</span> Date<span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'timestamp'</span><span class="token punctuation">,</span> <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'CURRENT_TIMESTAMP'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  update_time<span class="token operator">:</span> Date<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="1KFQPpLd5fLHjhjS9cr6XW" class="wolai-block wolai-text"><div><span class="inline-wrap">完成数据库的打通后，开始增加业务逻辑代码。</span></div></div><div id="3aZNCYoqj5aaUQY7YSB1k1" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="6aaF3c5Xz3vUDp3g8YJUJn" class="wolai-block"><span class="inline-wrap">HTTP<span class="jill"></span>装饰器</span></h3><div id="k4bcPecj5zszYX3nRRcaXk" class="wolai-block wolai-text"><div><span class="inline-wrap">HTTP 装饰器使用起来同样非常简单；
Nest 为所有标准的 HTTP 方法提供了相应的装饰器：</span></div></div><ul class="wolai-block"><li id="mEWkPd3qW4X39HTPu3oirU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Get()</code></span></li><li id="3B23A4ZKtezmVtGwW5rF7A"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Post()</code></span></li><li id="h2TaCX4oUHLFrJw5haNqzE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Put()</code></span></li><li id="kX1vjzkk1xt2uEUcSyWzS4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Delete()</code></span></li><li id="bvB3u8smKMKzb6e4qUnpui"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Patch()</code></span></li><li id="59uJoGZn4ioDkzpqN9TJz4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Options()</code></span></li><li id="txTiANQNf2A4KG77GG6CUj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Head()</code></span></li><li id="pRbQyTwx54JKMbhRn5yUWK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@All() </code></span><span class="inline-wrap">用于定义一个用于处理所有 HTTP 请求方法的处理程序。</span></li></ul><div id="dVR7z84Qcbecjo31SqHKmt" class="wolai-block wolai-text"><div><span class="inline-wrap">经过它们装饰的方法，可以对相应的<span class="jill"></span>HTTP<span class="jill"></span>请求进行响应。
同时它们可以接受一个字符串或一个字符串数组作为参数，这里的</span><span class="inline-wrap"><b>字符串</b></span><span class="inline-wrap">可以是固定的路径，也可以是</span><span class="inline-wrap"><b>通配符</b></span><span class="inline-wrap">。</span></div></div><code-block id="p3p1JCt33h5EDhPpGdGN9t" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Body<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> Delete<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Param<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Put<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ApiOperation<span class="token punctuation">,</span> ApiTags <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/swagger'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CreateProductDto <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./dto/create-product.dto'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ProductsService <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./products.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiTags</span></span><span class="token punctuation">(</span><span class="token string">'产品'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'products'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> productsService<span class="token operator">:</span> ProductsService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiOperation</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> summary<span class="token operator">:</span> <span class="token string">'创建产品'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> product<span class="token operator">:</span> CreateProductDto<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ProductsEntity<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Put</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> product<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Delete</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsService<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></pre></div></code-block><div id="tz2cfHamcN2vQYAJBtQccB" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h4 id="5LRjxn2QnDbWnzQ7sRaLSU" class="wolai-block"><span class="inline-wrap">@Req()、@Res()</span></h4><div id="vwVsLsgmaTfu83JogFEjkQ" class="wolai-block wolai-text"><div><span class="inline-wrap">Nest 提供了对底层平台（默认为 Express）的</span><span class="inline-wrap"><a target="_blank" rel="noopener" href="http://expressjs.com/en/api.html#req"><span>请求对象</span></a></span><span class="inline-wrap">（request）的访问方式。我们可以在待处理函数的签名中增加</span><span class="inline-wrap"><code>@Req()</code></span><span class="inline-wrap">装饰器，Nest 则会自动注入请求对象。</span></div></div><div id="4DHNVkC4EESEdN3oipF3j7" class="wolai-block wolai-text"><div><span class="inline-wrap">针对<span class="jill"></span>HTTP<span class="jill"></span>请求，Nest 提供了开箱即用的专有装饰器，如下</span></div></div><div id="2hhHqDif8teP5BWxtczMGq" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 370px"><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>装饰器</b></span></th><th style="width: 370px"><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>对应参数</b></span></th></tr></thead><tbody><tr><td><span class="inline-wrap">@Request()，@Req()</span></td><td><span class="inline-wrap">req</span></td></tr><tr><td><span class="inline-wrap">@Response()，@Res()*</span></td><td><span class="inline-wrap">res</span></td></tr><tr><td><span class="inline-wrap">@Next()</span></td><td><span class="inline-wrap">next</span></td></tr><tr><td><span class="inline-wrap">@Session()</span></td><td><span class="inline-wrap">req.session</span></td></tr><tr><td><span class="inline-wrap">@Param(key?: string)</span></td><td><span class="inline-wrap">req.params/req.params[key]</span></td></tr><tr><td><span class="inline-wrap">@Body(key?: string)</span></td><td><span class="inline-wrap">req.body/req.body[key]</span></td></tr><tr><td><span class="inline-wrap">@Query(key?: string)</span></td><td><span class="inline-wrap">req.query/req.query[key]</span></td></tr><tr><td><span class="inline-wrap">@Headers(name?: string)</span></td><td><span class="inline-wrap">req.headers/req.headers[name]</span></td></tr><tr><td><span class="inline-wrap">@Ip()</span></td><td><span class="inline-wrap">req.ip</span></td></tr><tr><td><span class="inline-wrap">@HostParam()</span></td><td><span class="inline-wrap">req.hosts</span></td></tr></tbody></table></div><div id="4mvAaoD3Zq9aAgUTqVUnoA" class="wolai-block wolai-text"><div><span class="inline-wrap">另外，Nest<span class="jill"></span>还支持较多的装饰器，例如</span></div></div><ul class="wolai-block"><li id="dkF9aTHtEcB64epMpxUKBt"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@HttpCode(statusCode)</code></span><span class="inline-wrap"> 修改响应状态码</span></li><li id="sVdukeLBifaNor4LoU26SN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Header(key, value)</code></span><span class="inline-wrap">  自定义响应头</span></li><li id="jPXiJYr6Dr2XL4A96p92Pg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@Redirect(url, statusCode|302)</code></span><span class="inline-wrap"> 设置重定向</span></li></ul><div id="enpdNw7rvLtCmEQ5MkeAkV" class="wolai-block wolai-text"><div><span class="inline-wrap">详细可参考</span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://docs.nestjs.com/controllers"><span>官方文档</span></a></span><span class="inline-wrap">查阅。</span></div></div><div id="iMXKuc8znNMgiqqKi2nAYE" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="hQPRDcSjY776EmSXShBfSo" class="wolai-block"><span class="inline-wrap">Repository</span></h3><div id="a8pf73Bu6fToHEL8GeCZAo" class="wolai-block wolai-text"><div><span class="inline-wrap">上面介绍了 </span><span class="inline-wrap"><b>TypeORM</b></span><span class="inline-wrap"> 以及 </span><span class="inline-wrap"><b>Entity</b></span><span class="inline-wrap">，这里具体化一下 service；</span></div></div><code-block id="aXoWFKGuL1Yyo1xhkCRv4M" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> HttpException<span class="token punctuation">,</span> Injectable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> InjectRepository <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Repository <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ProductsEntity <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./products.entity'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsService</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">InjectRepository</span></span><span class="token punctuation">(</span>ProductsEntity<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> productsRepository<span class="token operator">:</span> Repository<span class="token operator">&lt;</span>ProductsEntity<span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token comment">// 创建产品</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>product<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>ProductsEntity<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ProductsEntity<span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> title <span class="token punctuation">&#125;</span> <span class="token operator">=</span> product<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token string">'缺少产品标题'</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> where<span class="token operator">:</span> <span class="token punctuation">&#123;</span> title <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token string">'产品已存在'</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 获取指定产品</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ProductsEntity<span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">findOneBy</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> id <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 更新产品</span>
  <span class="token keyword">async</span> <span class="token function">updateById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> product<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ProductsEntity<span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> existProduct <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>existProduct<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">的产品不存在</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> updateProduct <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>existProduct<span class="token punctuation">,</span> product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>updateProduct<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 刪除产品</span>
  <span class="token keyword">async</span> <span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> existProduct <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>existProduct<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">的产品不存在</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>existProduct<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 获取产品列表</span>
  <span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ProductsEntity<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="c1RVoMZJqw8oUSYxaTbCDS" class="wolai-block wolai-text"><div><span class="inline-wrap">自此一个完成的请求就已经完成了，但为了接口更加规范，还可以再进一步完善；</span></div></div><div id="c4uAETuPtRLn6VVnSYHhot" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="huggnYtU3PxsU1cfcvJ9LQ" class="wolai-block"><span class="inline-wrap">过滤器</span></h3><div id="uQaJXzDCcUSxL4sRwtHZmt" class="wolai-block wolai-text"><div><span class="inline-wrap">过滤器也是 </span><span class="inline-wrap"><b>NestJS</b></span><span class="inline-wrap"> 的众多<span class="jill"></span>provider<span class="jill"></span>之一；这里用过滤器来简单处理错误请求；
</span><span class="inline-wrap"><code>nest g filter core/filter/http-exception</code></span><span class="inline-wrap">
代码实现：</span></div></div><code-block id="d7uZsfNUCpeoCPWdA9XGyE" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  ArgumentsHost<span class="token punctuation">,</span>
  Catch<span class="token punctuation">,</span>
  ExceptionFilter<span class="token punctuation">,</span>
  HttpException<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span>HttpException<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HttpExceptionFilter</span> <span class="token keyword">implements</span> <span class="token class-name">ExceptionFilter</span> <span class="token punctuation">&#123;</span>
  <span class="token function">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> HttpException<span class="token punctuation">,</span> host<span class="token operator">:</span> ArgumentsHost<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求上下文</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求上下文中的 response对象</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取异常状态码</span>

    <span class="token comment">// 设置错误信息</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> exception<span class="token punctuation">.</span>message
      <span class="token operator">?</span> exception<span class="token punctuation">.</span>message
      <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>status <span class="token operator">>=</span> <span class="token number">500</span> <span class="token operator">?</span> <span class="token string">'Service Error'</span> <span class="token operator">:</span> <span class="token string">'Client Error'</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> errorResponse <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      data<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> message<span class="token punctuation">,</span>
      code<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置返回的状态码， 请求头，发送错误信息</span>
    response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="ub8QLmR2ujZLLX7xRdsnhJ" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>main.js<span class="jill"></span>中注册：</span></div></div><code-block id="nZtAwuswBU97Ac6hwFYiBU" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> HttpExceptionFilter <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./core/filter/http-exception/http-exception.filter'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span>NestExpressApplication<span class="token operator">></span></span></span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册全局错误的过滤器</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalFilters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="g6dUQq6iEeDA3jH35vtpBL" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来对请求成功返回的格式进行统一的处理，可以用<span class="jill"></span>Nest.js<span class="jill"></span>的</span><span class="inline-wrap"><b>拦截器</b></span><span class="inline-wrap">来实现。</span></div></div><div id="oBwWAsRKffKGUqhZR83Zsb" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="jnRnLx5KqV45ZvDZXSGw2t" class="wolai-block"><span class="inline-wrap">拦截器</span></h3><div id="cFsDSr5e6WCKH5hkePP8GJ" class="wolai-block wolai-text"><div><span class="inline-wrap">拦截器可以在调用路由处理程序之前和之后访问响应/请求。比如 logger 或者 统一处理</span><span class="inline-wrap"><b>响应结果</b></span><span class="inline-wrap">；</span></div></div><div id="k3KC2JCscYEvJr7SzNsTmP" class="wolai-block wolai-text"><div><span class="inline-wrap">老配方，首先使用命令创建一个拦截器：
</span><span class="inline-wrap"><code>nest g interceptor core/interceptor/transform</code></span></div></div><div id="5pCnEmvSvrhWSxmmETdr8H" class="wolai-block wolai-text"><div><span class="inline-wrap">代码实现</span></div></div><code-block id="gcgpKkN9e514UbadWHpeVW" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  CallHandler<span class="token punctuation">,</span>
  ExecutionContext<span class="token punctuation">,</span>
  Injectable<span class="token punctuation">,</span>
  NestInterceptor<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> map<span class="token punctuation">,</span> Observable <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">TransformInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">NestInterceptor</span> <span class="token punctuation">&#123;</span>
  <span class="token function">intercept</span><span class="token punctuation">(</span>context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">,</span> next<span class="token operator">:</span> CallHandler<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
          data<span class="token punctuation">,</span>
          code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
          msg<span class="token operator">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="tQfDhBFJMdFR47rpqTMuaW" class="wolai-block wolai-text"><div><span class="inline-wrap">注册到<span class="jill"></span>main.js</span></div></div><code-block id="7ekbP7oUzKhaJgqKQkPsbC" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> TransformInterceptor <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./core/interceptor/transform/transform.interceptor'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span>NestExpressApplication<span class="token operator">></span></span></span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token comment">// 全局注册拦截器</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalInterceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransformInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="bgytXUUpjsA83neoMw1J6R" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="pdusHm5R5ccGjniCeddU11" class="wolai-block"><span class="inline-wrap">接口文档</span></h3><div id="mAVnad8ZBGTCebzFmRdkBN" class="wolai-block wolai-text"><div><span class="inline-wrap">规范化接口当然少不了接口文档，Nest<span class="jill"></span>也是完美支持 swagge，在</span><span class="inline-wrap"><b>product</b></span><span class="inline-wrap">
目录下创建一个</span><span class="inline-wrap"><code>dto</code></span><span class="inline-wrap">文件夹，再创建一个</span><span class="inline-wrap"><code>create-post.dto.ts</code></span><span class="inline-wrap">文件：</span></div></div><code-block id="6xiCYSAk5Dh5fMACiZW3Gs" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ApiProperty<span class="token punctuation">,</span> ApiPropertyOptional <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/swagger'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateProductDto</span> <span class="token punctuation">&#123;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">'产品标题'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">'产品描述'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> desc<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiPropertyOptional</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">'产品缩略图'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> thumb_url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">'产品类型'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> type<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="exF7AUGwXmkomwotyCtf9F" class="wolai-block wolai-text"><div><span class="inline-wrap">完善<span class="jill"></span>controller，进行说明：</span></div></div><code-block id="5USAcTJoyP1HrzRJU3U6Ws" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token operator">...</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiTags</span></span><span class="token punctuation">(</span><span class="token string">'产品'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'products'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> productsService<span class="token operator">:</span> ProductsService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiOperation</span></span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> summary<span class="token operator">:</span> <span class="token string">'创建产品'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> product<span class="token operator">:</span> CreateProductDto<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productsService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">...</span>
<span class="token punctuation">&#125;</span></pre></div></code-block><div id="f12wmMZmvc5WYnbg8DZu5c" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="1b7J6ux8Ntqia2Yi4h39Fo" class="wolai-block"><span class="inline-wrap">数据验证</span></h3><div id="uFJJ5syGhNxxwpu4Yqu1vE" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nest.js<span class="jill"></span>中，</span><span class="inline-wrap"><b>管道（Pipes）</b></span><span class="inline-wrap"> 就是专门用来做数据转换的，我们看一下它的定义：</span></div></div><blockquote id="fJg8v96ympMYJnSmWHEThc" class="wolai-block"><span class="inline-wrap">管道是具有 @Injectable() 装饰器的类。管道应实现 PipeTransform 接口。管道有两个类型:</span><ul class="wolai-block"><li id="8Fm1QADfsFBb4uPSgUWKe8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>转换</b></span><span class="inline-wrap">：管道将输入数据转换为所需的数据输出</span></li><li id="e3P4RnRJB9FabfgkwEQKya"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>验证</b></span><span class="inline-wrap">：对输入数据进行验证，如果验证成功继续传递; 验证失败则抛出异常;</span></li></ul><div id="ipCSsaxYkcgmt6mdgBsBeY" class="wolai-block wolai-text"><div><span class="inline-wrap">管道在异常区域内运行。这意味着当抛出异常时，它们由核心异常处理程序和应用于当前上下文的 </span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://docs.nestjs.cn/8/exceptionfilters"><span>异常过滤器</span></a></span><span class="inline-wrap"> 处理。当在 Pipe 中发生异常，controller 不会继续执行任何方法。</span></div></div></blockquote><div id="rYEbt9Nb24eoY2FYtJRo29" class="wolai-block wolai-text"><div><span class="inline-wrap">通俗来讲就是，对请求接口的入参进行验证和转换的前置操作，验证好了我才会将内容给到路由对应的方法中去，失败了就进入异常过滤器中。</span></div></div><div id="k9tyRFTDNwDUBjw16cTTRQ" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="1SajZGaSmpxag69e2rtdCB" class="wolai-block wolai-text"><div><span class="inline-wrap">安装依赖：</span></div></div><ul class="wolai-block"><li id="7MwwMJ4L6hj6bnCC8NdLJa"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>npm install class-validator class-transformer -S</code></span></li></ul><div id="tSsjHuUYjJmsjjm3jdZrs1" class="wolai-block wolai-text"><div><span class="inline-wrap">Nest.js<span class="jill"></span>自带了<span class="jill"></span>9<span class="jill"></span>个开箱即用的管道：</span></div></div><ol class="wolai-block"><li id="mtVxEngYpb3QokXS6n6Hed"><div class="marker"></div><span class="inline-wrap">ValidationPipe</span></li><li id="bMbFfUUp9xusaqR2KwwLzt"><div class="marker"></div><span class="inline-wrap">ParseIntPipe</span></li><li id="6r2wBw45fxGTUNLL8E1Zzm"><div class="marker"></div><span class="inline-wrap">ParseFloatPipe</span></li><li id="gs4miRrKYZsW4xXgk617tF"><div class="marker"></div><span class="inline-wrap">ParseBoolPipe</span></li><li id="tvdaxUAePfLEpv5vHWxMNU"><div class="marker"></div><span class="inline-wrap">ParseArrayPipe</span></li><li id="qWMEMjxgiU3vZz9eqHQm6H"><div class="marker"></div><span class="inline-wrap">ParseUUIDPipe</span></li><li id="8yQNoYPGRpy8zjGuM7KVsD"><div class="marker"></div><span class="inline-wrap">ParseEnumPipe</span></li><li id="snjtnm5gYePmUSjBgm9yqa"><div class="marker"></div><span class="inline-wrap">DefaultValuePipe</span></li><li id="s9xuDZxYr3Hd46a4szYeGx"><div class="marker"></div><span class="inline-wrap">ParseFilePipe</span></li></ol><div id="uezZf6DZmM4d8D9YtGk8Dp" class="wolai-block wolai-text"><div><span class="inline-wrap">可以单独使用</span></div></div><code-block id="aMWdCf1Z5auUWkXzCjEL7H" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> ParseIntPipe<span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>catsService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></pre></div></code-block><div id="eMhY3vMomyST1XXqhyvmzT" class="wolai-block wolai-text"><div></div></div><div id="uPxoMnSirLthRbGAfkwxGT" class="wolai-block wolai-text"><div><span class="inline-wrap">也可以配合 class-validator<span class="jill"></span>使用实现类校验器，可以完美的实现对参数类型进行验证，验证失败抛出异常。</span></div></div><div id="uNvi4okVKhHvhbA2X4ZN3m" class="wolai-block wolai-text"><div><span class="inline-wrap">管道验证操作通常用在<span class="jill"></span>dto<span class="jill"></span>这种传输层的文件中,用作验证操作。安装两个需要的依赖包：</span></div></div><div id="ihJin1RjoBoC3C4nLPFT1R" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>class-transformer</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>class-validator</code></span></div></div><div id="7ahXJ29MK6WBiNAk8SUdjb" class="wolai-block wolai-text"><div><span class="inline-wrap">安装依赖：</span></div></div><div id="vcvrAs7Tu2FCVu92iG3oFf" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>npm install class-validator class-transformer -S</code></span></div></div><div id="3Zb7PnjVUMynXFwfFVCNrf" class="wolai-block wolai-text"><div><span class="inline-wrap">然后在<span class="jill"></span>create-post.dto.ts<span class="jill"></span>文件中添加验证, 完善错误信息提示：</span></div></div><code-block id="qSsXjWXM8YFwvPmzijo9pD" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiProperty<span class="token punctuation">,</span> ApiPropertyOptional <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/swagger'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IsNotEmpty<span class="token punctuation">,</span> IsNumber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'class-validator'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateProductDto</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNotEmpty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'产品标题必填'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> description<span class="token operator">:</span> <span class="token string">'产品标题'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNotEmpty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'缺少产品描述'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> description<span class="token operator">:</span> <span class="token string">'产品描述'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> desc<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiPropertyOptional</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> description<span class="token operator">:</span> <span class="token string">'产品缩略图'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> thumb_url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNumber</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> description<span class="token operator">:</span> <span class="token string">'产品类型'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> type<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></code-block><blockquote id="m8tSw6s74CZzP33X3VJktM" class="wolai-block"><span class="inline-wrap">上面只编写了一些常用的验证，class-validator<span class="jill"></span>还提供了很多的验证方法， 感兴趣可以看</span><span class="inline-wrap"><a target="_blank" rel="noopener" href="https://github.com/typestack/class-validator#validation-messages"><span>官方文档</span></a></span><span class="inline-wrap">.</span></blockquote><div id="eN1gY9VXkFx6CvU9WR2HRb" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="htvJskYfA5Zu6WL32mULfC" class="wolai-block wolai-text"><div><span class="inline-wrap">最后我们还有一个重要的步骤， 就是在<span class="jill"></span>main.ts<span class="jill"></span>中全局注册一下管道</span><span class="inline-wrap"><b>ValidationPipe</b></span><span class="inline-wrap">：</span></div></div><code-block id="q192eF9ij9LDBQqvokWwQV" class="wolai-block"><div class="wolai-pre"><div data-lang="Typescript" class="marker"></div><pre><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ValidationPipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span>NestExpressApplication<span class="token operator">></span></span></span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token comment">// 注册校验管道</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalPipes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="n8zeC4GEKvfWDc4w2rXkmV" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 id="budrUjTXfrbRUNNf9jhkrP" class="wolai-block"><span class="inline-wrap">生命周期</span></h3><div id="mACFSmS9Y7mPmKNBiTZmyV" class="wolai-block wolai-text"><div><span class="inline-wrap">Nest<span class="jill"></span>在 </span><span class="inline-wrap"><b>modules</b></span><span class="inline-wrap"> ，</span><span class="inline-wrap"><b>providers</b></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><b>controllers</b></span><span class="inline-wrap"> 的以下每个生命周期事件中调用注册钩子方法。</span></div></div><div id="wxp3KHGNg1uKnNNnsKVgG8" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 241px"><span class="inline-wrap">生命周期钩子方法</span></th><th style="width: 484px"><span class="inline-wrap">生命周期时间触发钩子方法调用</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">OnModuleInit()</span></td><td><span class="inline-wrap">初始化主模块依赖处理后调用一次</span></td></tr><tr><td><span class="inline-wrap">OnApplicationBootstrap()</span></td><td><span class="inline-wrap">在应用程序完全启动并监听连接后调用一次</span></td></tr><tr><td><span class="inline-wrap">OnModuleDestroy()</span></td><td><span class="inline-wrap">收到终止信号(例如<span class="jill"></span>SIGTERM)后调用</span></td></tr><tr><td><span class="inline-wrap">beforeApplicationShutdown()</span></td><td><span class="inline-wrap">在<span class="jill"></span>onModuleDestroy()完成(Promise<span class="jill"></span>被<span class="jill"></span>resolved<span class="jill"></span>或者<span class="jill"></span>rejected)；一旦完成，将关闭所有连接(调用<span class="jill"></span>app.close() 方法).</span></td></tr><tr><td><span class="inline-wrap">OnApplicationShutdown()</span></td><td><span class="inline-wrap">连接关闭处理时调用(app.close())</span></td></tr></tbody></table></div><div id="7Cwx3ksi9akqUjUpnhTqz7" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h2 id="xt3v1bVA2cKVCbPGafegvw" class="wolai-block"><span class="inline-wrap">总结</span></h2><div id="nghMbVvEyw3HypqwccYkxP" class="wolai-block wolai-text"><div><span class="red inline-wrap">NodeJS</span><span class="inline-wrap">后端已经有很好生态，各类工程化与微服务需要功能都有了<span class="jill"></span>npm<span class="jill"></span>版本，内部数据通过<span class="jill"></span>TypeScript<span class="jill"></span>验证保证类型无误，只要处理好输入数据的验证和转换问题，是可以在实际项目中发挥力量的，但是，如果需要执行大量的计算（物联网，电子商务平台，大数据），那么使用<span class="jill"></span>Spring Boot<span class="jill"></span>会是更好的选择。</span></div></div><div id="kKE2KyGo1wGY3b3NGmMFN7" class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>
        
      </div>

         
    </div>
    
     
  </div>
  
    

  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2023 Huangjiexin<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
